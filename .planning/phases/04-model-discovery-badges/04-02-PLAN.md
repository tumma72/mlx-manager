---
phase: 04-model-discovery-badges
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - frontend/src/lib/api/types.ts
  - frontend/src/lib/api/client.ts
  - frontend/src/lib/stores/models.svelte.ts
  - frontend/src/lib/components/models/badges/ArchitectureBadge.svelte
  - frontend/src/lib/components/models/badges/MultimodalBadge.svelte
  - frontend/src/lib/components/models/badges/QuantizationBadge.svelte
  - frontend/src/lib/components/models/ModelBadges.svelte
  - frontend/src/lib/components/models/ModelSpecs.svelte
  - frontend/src/lib/components/models/ModelCard.svelte
  - frontend/src/lib/components/models/index.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Model tiles display architecture badge (Llama, Qwen, etc.)"
    - "Multimodal models show green vision badge"
    - "Quantization level shown as badge (4-bit, 8-bit, etc.)"
    - "Clicking 'Show specs' reveals technical details"
    - "Badges load progressively for HuggingFace search results"
  artifacts:
    - path: "frontend/src/lib/components/models/badges/ArchitectureBadge.svelte"
      provides: "Blue badge for architecture family"
      contains: "architecture_family"
    - path: "frontend/src/lib/components/models/badges/MultimodalBadge.svelte"
      provides: "Green badge for multimodal capability"
      contains: "is_multimodal"
    - path: "frontend/src/lib/components/models/ModelSpecs.svelte"
      provides: "Expandable specs section"
      contains: "expanded"
    - path: "frontend/src/lib/stores/models.svelte.ts"
      provides: "Config store with lazy loading"
      contains: "fetchConfig"
  key_links:
    - from: "ModelCard.svelte"
      to: "ModelBadges.svelte"
      via: "component import"
      pattern: "ModelBadges"
    - from: "stores/models.svelte.ts"
      to: "/api/models/config"
      via: "fetch call"
      pattern: "api/models/config"
---

<objective>
Add visual badges and expandable specs to model tiles for displaying model characteristics.

Purpose: Help users quickly identify model capabilities (architecture, multimodal, quantization) and view technical specs on demand.

Output: Badge components, ModelSpecs expandable section, model config store for lazy loading, updated ModelCard with badges.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-model-discovery-badges/04-CONTEXT.md
@.planning/phases/04-model-discovery-badges/04-RESEARCH.md
@.planning/phases/04-model-discovery-badges/04-01-SUMMARY.md

@frontend/src/lib/api/types.ts
@frontend/src/lib/api/client.ts
@frontend/src/lib/components/models/ModelCard.svelte
@frontend/src/lib/components/ui/badge.svelte
@frontend/src/lib/stores/downloads.svelte.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add types and API client method for model config</name>
  <files>
    frontend/src/lib/api/types.ts
    frontend/src/lib/api/client.ts
  </files>
  <action>
    1. In types.ts, add ModelCharacteristics interface:
       ```typescript
       export interface ModelCharacteristics {
         model_type?: string;
         architecture_family?: string;
         max_position_embeddings?: number;
         num_hidden_layers?: number;
         hidden_size?: number;
         vocab_size?: number;
         num_attention_heads?: number;
         num_key_value_heads?: number;
         quantization_bits?: number;
         quantization_group_size?: number;
         is_multimodal?: boolean;
         multimodal_type?: string;
         use_cache?: boolean;
       }
       ```

    2. Update LocalModel interface to include optional characteristics:
       ```typescript
       export interface LocalModel {
         model_id: string;
         local_path: string;
         size_bytes: number;
         size_gb: number;
         characteristics?: ModelCharacteristics;
       }
       ```

    3. In client.ts, add method to models object:
       ```typescript
       async getConfig(modelId: string): Promise<ModelCharacteristics> {
         const response = await fetch(
           `${API_BASE}/models/config/${encodeURIComponent(modelId)}`,
           { headers: getAuthHeaders() }
         );
         return handleResponse(response);
       }
       ```
  </action>
  <verify>
    cd frontend && npm run check
  </verify>
  <done>
    - ModelCharacteristics interface added to types.ts
    - LocalModel includes optional characteristics field
    - models.getConfig() method added to client.ts
  </done>
</task>

<task type="auto">
  <name>Task 2: Create badge components and ModelSpecs</name>
  <files>
    frontend/src/lib/components/models/badges/ArchitectureBadge.svelte
    frontend/src/lib/components/models/badges/MultimodalBadge.svelte
    frontend/src/lib/components/models/badges/QuantizationBadge.svelte
    frontend/src/lib/components/models/ModelBadges.svelte
    frontend/src/lib/components/models/ModelSpecs.svelte
    frontend/src/lib/components/models/index.ts
  </files>
  <action>
    1. Create badges/ directory and ArchitectureBadge.svelte:
       - Props: family: string
       - Use Badge component with outline variant
       - Styling: blue background (bg-blue-100 text-blue-800 border-blue-300, dark mode equivalents)
       - Icon: Cpu from lucide-svelte
       - Display: "{family}" (e.g., "Llama", "Qwen")

    2. Create MultimodalBadge.svelte:
       - Props: multimodalType: string (e.g., "vision")
       - Use Badge with success variant or green styling
       - Styling: green background (bg-green-100 text-green-800 border-green-300)
       - Icon: Eye from lucide-svelte
       - Display: "Vision" (or capitalize multimodalType)

    3. Create QuantizationBadge.svelte:
       - Props: bits: number
       - Use Badge with outline variant
       - Styling: purple background (bg-purple-100 text-purple-800 border-purple-300)
       - Icon: Layers from lucide-svelte
       - Display: "{bits}-bit" (e.g., "4-bit")

    4. Create ModelBadges.svelte:
       - Props: characteristics: ModelCharacteristics | null | undefined, loading?: boolean
       - Render all applicable badges in a flex row with gap-1.5
       - Show skeleton badges while loading (gray placeholders)
       - Conditionally render:
         - ArchitectureBadge if architecture_family exists and != "Unknown"
         - MultimodalBadge if is_multimodal === true
         - QuantizationBadge if quantization_bits exists

    5. Create ModelSpecs.svelte:
       - Props: characteristics: ModelCharacteristics
       - State: expanded = $state(false)
       - Show toggle button: "Show specs" / "Hide specs" with ChevronDown/ChevronUp icons
       - Use svelte slide transition for expand/collapse
       - Display specs grouped:
         - Context: max_position_embeddings (format with toLocaleString())
         - Layers: num_hidden_layers
         - Hidden size: hidden_size
         - Vocab size: vocab_size
         - Attention: num_attention_heads (and num_key_value_heads if different)
         - KV Cache: use_cache (Yes/No)
       - Only show fields that exist (conditional rendering)

    6. Update index.ts to export new components:
       ```typescript
       export { default as ArchitectureBadge } from './badges/ArchitectureBadge.svelte';
       export { default as MultimodalBadge } from './badges/MultimodalBadge.svelte';
       export { default as QuantizationBadge } from './badges/QuantizationBadge.svelte';
       export { default as ModelBadges } from './ModelBadges.svelte';
       export { default as ModelSpecs } from './ModelSpecs.svelte';
       ```
  </action>
  <verify>
    cd frontend && npm run check && npm run lint
  </verify>
  <done>
    - Three badge components created with correct styling
    - ModelBadges container renders appropriate badges
    - ModelSpecs shows expandable technical details
    - All components exported from index.ts
  </done>
</task>

<task type="auto">
  <name>Task 3: Add config store and update ModelCard</name>
  <files>
    frontend/src/lib/stores/models.svelte.ts
    frontend/src/lib/components/models/ModelCard.svelte
    frontend/src/lib/stores/index.ts
  </files>
  <action>
    1. Create stores/models.svelte.ts with ModelConfigStore class:
       ```typescript
       import { models as modelsApi } from '$api';
       import type { ModelCharacteristics } from '$api';

       interface ConfigState {
         characteristics: ModelCharacteristics | null;
         loading: boolean;
         error: string | null;
       }

       class ModelConfigStore {
         private configs = $state<Map<string, ConfigState>>(new Map());

         getConfig(modelId: string): ConfigState | undefined {
           return this.configs.get(modelId);
         }

         async fetchConfig(modelId: string): Promise<void> {
           // Don't refetch if already loaded or loading
           const existing = this.configs.get(modelId);
           if (existing?.characteristics || existing?.loading) return;

           // Set loading state (create new Map for reactivity)
           this.configs = new Map(this.configs).set(modelId, {
             characteristics: null,
             loading: true,
             error: null
           });

           try {
             const characteristics = await modelsApi.getConfig(modelId);
             this.configs = new Map(this.configs).set(modelId, {
               characteristics,
               loading: false,
               error: null
             });
           } catch (e) {
             this.configs = new Map(this.configs).set(modelId, {
               characteristics: null,
               loading: false,
               error: e instanceof Error ? e.message : 'Failed to load config'
             });
           }
         }
       }

       export const modelConfigStore = new ModelConfigStore();
       ```

    2. Export from stores/index.ts:
       ```typescript
       export { modelConfigStore } from './models.svelte';
       ```

    3. Update ModelCard.svelte:
       - Import ModelBadges, ModelSpecs from '$components/models'
       - Import modelConfigStore from '$stores'
       - Add derived state for config:
         ```typescript
         let configState = $derived(modelConfigStore.getConfig(model.model_id));
         ```
       - Trigger config fetch on mount via $effect:
         ```typescript
         $effect(() => {
           // Fetch config for this model (lazy load)
           modelConfigStore.fetchConfig(model.model_id);
         });
         ```
       - Add ModelBadges below the model name:
         ```svelte
         <ModelBadges
           characteristics={configState?.characteristics}
           loading={configState?.loading ?? true}
         />
         ```
       - Add ModelSpecs below the badges (only if characteristics exist):
         ```svelte
         {#if configState?.characteristics}
           <ModelSpecs characteristics={configState.characteristics} />
         {/if}
         ```
       - Adjust layout: badges go in a new row below h3, specs go below badges
  </action>
  <verify>
    cd frontend && npm run check && npm run lint
    # Start dev server and visually verify badges appear on model cards
    # npm run dev
  </verify>
  <done>
    - ModelConfigStore class handles lazy loading with proper reactivity
    - ModelCard triggers config fetch on mount
    - Badges display progressively as configs load
    - Specs expandable section works
    - No TypeScript or lint errors
  </done>
</task>

</tasks>

<verification>
1. Run frontend type check: `cd frontend && npm run check`
2. Run frontend linting: `cd frontend && npm run lint`
3. Start dev server and verify:
   - Search for models
   - Badges appear (may load progressively)
   - Click "Show specs" expands technical details
   - Downloaded models show badges from local cache (instant)
</verification>

<success_criteria>
- Model cards display architecture, multimodal, and quantization badges
- Badges have correct colors (blue, green, purple)
- "Show specs" reveals technical details with smooth animation
- Config loading is lazy (doesn't block search results)
- Frontend passes type check and lint
</success_criteria>

<output>
After completion, create `.planning/phases/04-model-discovery-badges/04-02-SUMMARY.md`
</output>
