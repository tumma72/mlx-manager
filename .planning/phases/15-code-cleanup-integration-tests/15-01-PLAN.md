---
phase: 15-code-cleanup-integration-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/mlx_manager/mlx_server/models/adapters/parsers/__init__.py
  - backend/mlx_manager/mlx_server/models/adapters/parsers/base.py
  - backend/mlx_manager/mlx_server/models/adapters/parsers/glm4.py
  - backend/mlx_manager/mlx_server/models/adapters/parsers/llama.py
  - backend/mlx_manager/mlx_server/models/adapters/parsers/qwen.py
  - backend/mlx_manager/mlx_server/models/adapters/base.py
  - backend/mlx_manager/mlx_server/models/adapters/qwen.py
  - backend/mlx_manager/mlx_server/models/adapters/glm4.py
  - backend/mlx_manager/mlx_server/models/adapters/llama.py
  - backend/mlx_manager/mlx_server/services/inference.py
  - backend/tests/mlx_server/test_tool_calling.py
  - backend/tests/mlx_server/test_reasoning.py
autonomous: true

must_haves:
  truths:
    - "Parsers directory is deleted"
    - "No code references deleted parsers"
    - "All tests pass after removal"
  artifacts:
    - path: "backend/mlx_manager/mlx_server/models/adapters/parsers/"
      provides: "DELETED - no longer exists"
    - path: "backend/mlx_manager/mlx_server/models/adapters/base.py"
      provides: "ModelAdapter protocol without parse_tool_calls/extract_reasoning"
  key_links:
    - from: "adapters/*.py"
      to: "response_processor.py"
      via: "ResponseProcessor handles all parsing"
      pattern: "from.*response_processor import|get_response_processor"
---

<objective>
Remove dead parser code that was replaced by ResponseProcessor in Phase 14.

Purpose: The adapters/parsers/ directory contains QwenToolParser, LlamaToolParser, GLM4ToolParser classes that are now dead code. ResponseProcessor (Phase 14-07) handles all tool call and reasoning extraction via single-pass processing. These old parsers duplicate functionality and create maintenance burden.

Output: Clean codebase with parsers directory deleted, adapter methods removed, imports cleaned up, and tests updated.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@backend/mlx_manager/mlx_server/models/adapters/parsers/__init__.py
@backend/mlx_manager/mlx_server/models/adapters/base.py
@backend/mlx_manager/mlx_server/services/response_processor.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove parser imports and delete parsers directory</name>
  <files>
    backend/mlx_manager/mlx_server/models/adapters/qwen.py
    backend/mlx_manager/mlx_server/models/adapters/glm4.py
    backend/mlx_manager/mlx_server/models/adapters/llama.py
    backend/mlx_manager/mlx_server/models/adapters/parsers/ (DELETE)
  </files>
  <action>
    1. Find and remove all parser imports from adapters:
       - In qwen.py: Remove `from mlx_manager.mlx_server.models.adapters.parsers.qwen import QwenToolParser`
       - In glm4.py: Remove `from mlx_manager.mlx_server.models.adapters.parsers.glm4 import GLM4ToolParser`
       - In llama.py: Remove `from mlx_manager.mlx_server.models.adapters.parsers.llama import LlamaToolParser`

    2. Remove any parser-related class attributes from adapters (e.g., `tool_parser = QwenToolParser()`)

    3. Delete the entire parsers directory:
       - backend/mlx_manager/mlx_server/models/adapters/parsers/

    4. Verify no remaining imports with: `grep -r "from.*adapters.parsers" backend/`
  </action>
  <verify>
    - `ls backend/mlx_manager/mlx_server/models/adapters/parsers/ 2>&1` returns "No such file or directory"
    - `grep -r "from.*adapters.parsers" backend/mlx_manager/` returns empty
  </verify>
  <done>Parsers directory deleted and all import references removed from adapter files</done>
</task>

<task type="auto">
  <name>Task 2: Remove parse_tool_calls and extract_reasoning from ModelAdapter protocol</name>
  <files>
    backend/mlx_manager/mlx_server/models/adapters/base.py
    backend/mlx_manager/mlx_server/models/adapters/qwen.py
    backend/mlx_manager/mlx_server/models/adapters/glm4.py
    backend/mlx_manager/mlx_server/models/adapters/llama.py
    backend/mlx_manager/mlx_server/services/inference.py
  </files>
  <action>
    1. In base.py (ModelAdapter Protocol):
       - Remove `parse_tool_calls(text: str) -> list[ToolCall] | None` method definition
       - Remove `extract_reasoning(text: str) -> tuple[str, str | None]` method definition

    2. In DefaultAdapter class (base.py):
       - Remove `parse_tool_calls` method implementation
       - Remove `extract_reasoning` method implementation

    3. In qwen.py, glm4.py, llama.py adapters:
       - Remove `parse_tool_calls` method if overridden
       - Remove `extract_reasoning` method if overridden
       - Remove any unused parser-related methods

    4. In inference.py:
       - Check for any calls to adapter.parse_tool_calls() or adapter.extract_reasoning()
       - These should already be replaced by ResponseProcessor.process()
       - If any remain, update to use get_response_processor().process()

    5. Clean up any orphaned imports (ToolCall, etc.) that are no longer needed
  </action>
  <verify>
    - `grep -r "parse_tool_calls\|extract_reasoning" backend/mlx_manager/mlx_server/models/adapters/` returns empty or only docstrings/comments
    - `grep "parse_tool_calls\|extract_reasoning" backend/mlx_manager/mlx_server/services/inference.py` returns empty
  </verify>
  <done>parse_tool_calls and extract_reasoning methods removed from protocol and all adapter implementations</done>
</task>

<task type="auto">
  <name>Task 3: Update tests and verify clean build</name>
  <files>
    backend/tests/mlx_server/test_tool_calling.py
    backend/tests/mlx_server/test_reasoning.py
  </files>
  <action>
    1. In test_tool_calling.py:
       - Remove imports: `from mlx_manager.mlx_server.models.adapters.parsers.glm4 import GLM4ToolParser`
       - Remove imports: `from mlx_manager.mlx_server.models.adapters.parsers.llama import LlamaToolParser`
       - Remove imports: `from mlx_manager.mlx_server.models.adapters.parsers.qwen import QwenToolParser`
       - Remove or refactor tests that directly test parser classes
       - Keep tests that test tool calling behavior via ResponseProcessor

    2. In test_reasoning.py:
       - Remove any tests that directly test adapter.extract_reasoning()
       - Keep tests that test reasoning extraction via ResponseProcessor

    3. Run full test suite to verify nothing is broken:
       ```bash
       cd backend && source .venv/bin/activate && pytest -v
       ```

    4. Run type checking:
       ```bash
       cd backend && source .venv/bin/activate && mypy mlx_manager
       ```

    5. Run linting:
       ```bash
       cd backend && source .venv/bin/activate && ruff check .
       ```
  </action>
  <verify>
    - `cd backend && pytest -v` passes all tests
    - `cd backend && mypy mlx_manager` has no new errors
    - `cd backend && ruff check .` passes
  </verify>
  <done>All tests updated to not reference deleted code, full test suite passes, no type or lint errors</done>
</task>

</tasks>

<verification>
1. Parsers directory no longer exists: `ls backend/mlx_manager/mlx_server/models/adapters/parsers/` fails
2. No references to parsers: `grep -r "from.*parsers" backend/mlx_manager/` returns empty
3. No parse_tool_calls/extract_reasoning in adapters: `grep -r "parse_tool_calls\|extract_reasoning" backend/mlx_manager/mlx_server/models/adapters/` returns empty
4. All tests pass: `cd backend && pytest -v`
5. Type checking passes: `cd backend && mypy mlx_manager`
</verification>

<success_criteria>
- adapters/parsers/ directory is deleted
- No code references QwenToolParser, LlamaToolParser, GLM4ToolParser
- No code references parse_tool_calls or extract_reasoning adapter methods
- All existing tests pass
- Type checking and linting pass
</success_criteria>

<output>
After completion, create `.planning/phases/15-code-cleanup-integration-tests/15-01-SUMMARY.md`
</output>
