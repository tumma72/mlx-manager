---
phase: 01-models-panel-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/routes/models/+page.svelte
  - frontend/src/lib/components/models/ModelCard.svelte
autonomous: false
must_haves:
  truths:
    - "Search/filter bar remains visible when scrolling the model list"
    - "When download starts, only download tile visible at top (original model tile hidden)"
    - "Non-downloading model tiles show no progress bar"
  artifacts:
    - path: "frontend/src/routes/models/+page.svelte"
      provides: "Sticky search bar, filtered results excluding active downloads"
      contains: "sticky"
    - path: "frontend/src/lib/components/models/ModelCard.svelte"
      provides: "Clean model tile without progress bar"
  key_links:
    - from: "models/+page.svelte displayResults"
      to: "activeDownloads filter"
      via: "exclude models being downloaded from grid"
      pattern: "filter.*activeDownloads"
---

<objective>
Fix models panel layout: anchor search bar and consolidate download UX

Purpose: Improve models panel usability by keeping search visible during scroll and eliminating duplicate download displays. Currently, downloading models appear both in the sticky download section AND in the results grid with progress bars.

Output: Cleaner models panel where search stays fixed, downloads appear only in the dedicated download tile section, and normal model tiles are simplified.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Codebase conventions
@.planning/codebase/CONVENTIONS.md

# Source files to modify
@frontend/src/routes/models/+page.svelte
@frontend/src/lib/components/models/ModelCard.svelte
@frontend/src/lib/components/models/DownloadProgressTile.svelte
@frontend/src/lib/stores/downloads.svelte.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Anchor search bar and hide downloading models from grid</name>
  <files>frontend/src/routes/models/+page.svelte</files>
  <action>
    1. **Make search card sticky:**
       - Find the search/filter Card section (around line 141-176)
       - Wrap it in a sticky container: `<div class="sticky top-0 z-20 bg-background pb-4">`
       - The downloads section is already sticky with z-10, search should be z-20 to layer above it when scrolling
       - Add `pt-2` padding-top to prevent content jumping

    2. **Filter active downloads from all result grids:**
       - Find `displayResults` derived (around line 104-108)
       - Modify to exclude models with active downloads:
         ```typescript
         let displayResults = $derived(() => {
           const activeIds = new Set(activeDownloads().map(d => d.model_id));
           const resultsToShow = showDownloaded ? results : results.filter(r => !r.is_downloaded);
           return resultsToShow.filter(r => !activeIds.has(r.model_id));
         });
         ```
       - Do the same for `filteredLocalModels` derived if it exists
       - In the "Local Models" section (around line 235), add similar filtering

    3. **Adjust download section positioning:**
       - Find download section (around line 117-128)
       - Change to `sticky top-[calc(var(--search-height,0px)+1rem)]` or use fixed offset
       - Alternatively: Place downloads section AFTER search sticky container so they stack naturally

    4. **Layout structure should be:**
       ```
       <div class="sticky top-0 z-20 bg-background pb-4">
         <!-- Search/filter card -->
       </div>
       {#if activeDownloads().length > 0}
         <div class="sticky top-[60px] z-10 ...">
           <!-- Download tiles -->
         </div>
       {/if}
       <!-- Scrollable results grids -->
       ```

    Avoid: Don't remove the activeDownloads section - it's the consolidated download display. Only filter models OUT of the regular grids, not from the download tiles section.
  </action>
  <verify>
    - `npm run check` passes (no TypeScript errors)
    - Search card uses sticky positioning
    - displayResults filters out active download model IDs
  </verify>
  <done>
    - Search bar has `sticky top-0` in a container
    - Models being downloaded are excluded from results grids
    - Download tiles section remains visible above results
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove progress bar from ModelCard</name>
  <files>frontend/src/lib/components/models/ModelCard.svelte</files>
  <action>
    1. **Remove progress bar section:**
       - Find the conditional block showing progress bar (around lines 122-144)
       - This is the `{#if downloading && downloadState}` block
       - Delete the entire block including the progress bar, byte counts, and percentage display

    2. **Remove unused derived values:**
       - Find `downloading` derived (around line 24): `let downloading = $derived(downloadsStore.isDownloading(model.model_id))`
       - Find `downloadState` derived (around line 25): `let downloadState = $derived(downloadsStore.getProgress(model.model_id))`
       - Delete both lines as they're no longer needed
       - Check if `downloadsStore` import is still needed for other uses - if not, remove import

    3. **Simplify button section:**
       - The button section (around lines 145-162) currently has `{:else}` after the progress block
       - After removing progress block, this becomes the only content in that area
       - Remove the `{:else}` and just have the buttons render directly
       - Keep the existing button logic (Download if not downloaded, Use/Delete if downloaded)

    4. **Clean up any orphaned formatting helpers:**
       - Check if `formatBytes` or similar are still used
       - Remove unused imports

    Avoid: Don't remove the `isDownloaded` derived - it's still used for button display logic. Only remove `downloading` and `downloadState` which were for progress display.
  </action>
  <verify>
    - `npm run check` passes
    - ModelCard.svelte no longer contains progress bar markup
    - No TypeScript errors about unused imports
  </verify>
  <done>
    - Progress bar section removed from ModelCard
    - `downloading` and `downloadState` derived values removed
    - Component simplified to show only buttons/badges
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Models panel with sticky search and consolidated download display</what-built>
  <how-to-verify>
    1. Run: `cd frontend && npm run dev` (or use existing dev server)
    2. Visit: http://localhost:5173/models (or your dev port)
    3. **Test sticky search:**
       - Scroll down through model list
       - Verify search/filter bar stays pinned at top
       - Verify no visual glitches or overlapping
    4. **Test download consolidation:**
       - Start a model download (pick a small model)
       - Verify original model tile disappears from results grid
       - Verify download appears ONLY in the download tiles section at top
       - Verify no progress bar visible in any regular model tiles
    5. **Test completed download:**
       - Wait for download to complete (or use already-downloaded model)
       - Verify completed model appears in "Downloaded Models" section
       - Verify no duplicate tiles
    6. **Check dark mode:** Toggle dark mode and verify layout still works
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd frontend && npm run check` passes
- [ ] `cd frontend && npm run lint` passes (or only pre-existing warnings)
- [ ] Search bar is sticky (has `sticky top-0` class)
- [ ] Active downloads filtered from displayResults
- [ ] ModelCard has no progress bar code
- [ ] Visual verification passed (checkpoint approved)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- User approved visual behavior in checkpoint
- Requirements satisfied:
  - MODELS-01: Search bar anchored at top ✓
  - MODELS-02: Download tile at top, original hidden ✓
  - MODELS-03: No progress bar on normal tiles ✓
</success_criteria>

<output>
After completion, create `.planning/phases/01-models-panel-ux/01-01-SUMMARY.md`
</output>
