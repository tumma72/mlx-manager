---
phase: 02-server-panel-redesign
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/lib/components/servers/ProfileSelector.svelte
  - frontend/src/lib/components/servers/index.ts
  - frontend/src/routes/servers/+page.svelte
autonomous: true

must_haves:
  truths:
    - "User can type to filter profiles by name or model path"
    - "User can select a profile from dropdown"
    - "User can click Start button to launch selected profile"
    - "After starting, selection is cleared"
  artifacts:
    - path: "frontend/src/lib/components/servers/ProfileSelector.svelte"
      provides: "Searchable dropdown with Start button"
      min_lines: 50
    - path: "frontend/src/routes/servers/+page.svelte"
      provides: "Server page using ProfileSelector"
      contains: "ProfileSelector"
  key_links:
    - from: "ProfileSelector.svelte"
      to: "profileStore"
      via: "profiles prop"
      pattern: "profiles"
    - from: "ProfileSelector.svelte"
      to: "serverStore.start"
      via: "onStart callback"
      pattern: "onStart"
---

<objective>
Create searchable profile dropdown component to replace profile list for starting new servers.

Purpose: The current UI shows all profiles as cards, which takes up space and makes running servers less prominent. A compact dropdown with search focuses attention on running servers while keeping "start new server" easily accessible.

Output: `ProfileSelector.svelte` component with bits-ui Combobox, integrated into server page.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-server-panel-redesign/02-RESEARCH.md

@frontend/src/lib/components/ui/index.ts
@frontend/src/lib/stores/profiles.svelte.ts
@frontend/src/routes/servers/+page.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProfileSelector component</name>
  <files>frontend/src/lib/components/servers/ProfileSelector.svelte</files>
  <action>
    Create a new component using bits-ui Combobox for profile selection:

    ```svelte
    <script lang="ts">
      import { Combobox } from 'bits-ui';
      import type { ServerProfile } from '$api';
      import { Button } from '$components/ui';
      import { Play, ChevronDown, Loader2 } from 'lucide-svelte';

      interface Props {
        profiles: ServerProfile[];
        onStart: (profile: ServerProfile) => Promise<void>;
        disabled?: boolean;
      }

      let { profiles, onStart, disabled = false }: Props = $props();

      let selectedValue = $state<string>('');
      let searchValue = $state('');
      let open = $state(false);
      let starting = $state(false);

      const filteredProfiles = $derived(
        searchValue === ''
          ? profiles
          : profiles.filter(p =>
              p.name.toLowerCase().includes(searchValue.toLowerCase()) ||
              p.model_path.toLowerCase().includes(searchValue.toLowerCase())
            )
      );

      const selectedProfile = $derived(
        profiles.find(p => p.id?.toString() === selectedValue)
      );

      async function handleStart() {
        if (selectedProfile && !starting) {
          starting = true;
          try {
            await onStart(selectedProfile);
            // Clear selection after successful start
            selectedValue = '';
            searchValue = '';
          } finally {
            starting = false;
          }
        }
      }

      function handleOpenChange(isOpen: boolean) {
        open = isOpen;
        if (!isOpen) {
          // Clear search when closing without selection
          searchValue = '';
        }
      }
    </script>
    ```

    The template should:
    1. Show Combobox.Input with placeholder "Select profile to start..."
    2. On right: ChevronDown trigger button
    3. Portal-rendered dropdown with profile list
    4. Each item shows: name (bold) + model_path (muted, truncated)
    5. "No profiles found" empty state
    6. Start button next to input (disabled when no selection or starting)

    Style with existing Tailwind patterns:
    - Input: `h-10 rounded-md border border-input bg-background px-3 py-2 text-sm`
    - Item: `px-2 py-1.5 text-sm rounded cursor-pointer data-[highlighted]:bg-accent`
    - Content: `bg-popover border rounded-md shadow-md p-1 max-h-60 overflow-auto z-50`
  </action>
  <verify>cd frontend && npm run check</verify>
  <done>ProfileSelector component created with searchable dropdown and Start button</done>
</task>

<task type="auto">
  <name>Task 2: Export component from servers index</name>
  <files>frontend/src/lib/components/servers/index.ts</files>
  <action>
    Create or update the barrel file to export the new component:

    ```typescript
    export { default as ProfileSelector } from './ProfileSelector.svelte';
    ```

    If the file doesn't exist, create it. If it exists, add the export.
  </action>
  <verify>cd frontend && npm run check</verify>
  <done>ProfileSelector exported from components/servers</done>
</task>

<task type="auto">
  <name>Task 3: Integrate ProfileSelector into server page</name>
  <files>frontend/src/routes/servers/+page.svelte</files>
  <action>
    Update the server page to use ProfileSelector instead of showing stopped profiles as cards:

    1. Import ProfileSelector:
       ```typescript
       import { ProfileSelector } from '$components/servers';
       ```

    2. Add handler for starting:
       ```typescript
       async function handleStartProfile(profile: ServerProfile) {
         await serverStore.start(profile.id);
       }
       ```

    3. Replace the "Available Profiles" section with ProfileSelector:
       - Place it after the "Running Servers" section header area
       - Pass `stoppedProfiles` as the profiles prop
       - Wire up `onStart={handleStartProfile}`

    4. Remove the stopped profiles section that shows ProfileCard for each stopped profile

    5. Update "New Profile" button to remain accessible (keep in header)

    Layout should be:
    ```
    [Header: "Server Dashboard" + Refresh + New Profile buttons]
    [ProfileSelector: dropdown + Start button]
    [Running Servers section: rich tiles]
    ```
  </action>
  <verify>cd frontend && npm run check && npm run lint</verify>
  <done>Server page uses ProfileSelector for starting servers</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd frontend && npm run check` passes
- [ ] `cd frontend && npm run lint` passes
- [ ] Manual: Visit /servers, verify dropdown appears with profile list
- [ ] Manual: Type in dropdown, verify filtering works
- [ ] Manual: Select profile and click Start, verify server starts
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- User can search profiles by name or model path
- User can select and start a profile via dropdown
- Selection clears after starting
- No more profile cards for stopped profiles
</success_criteria>

<output>
After completion, create `.planning/phases/02-server-panel-redesign/02-02-SUMMARY.md`
</output>
