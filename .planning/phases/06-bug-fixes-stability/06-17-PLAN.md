---
phase: 06-bug-fixes-stability
plan: 17
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/routes/(protected)/chat/+page.svelte
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Extensionless text files (README, Makefile, Dockerfile, LICENSE) accepted as attachments"
    - "Extension-based detection still works for files with extensions (.md, .py, .js)"
    - "File validation uses allowlist when no extension present"
  artifacts:
    - path: "frontend/src/routes/(protected)/chat/+page.svelte"
      provides: "Extensionless file detection via KNOWN_TEXT_FILENAMES allowlist"
      contains: "KNOWN_TEXT_FILENAMES"
  key_links:
    - from: "frontend/src/routes/(protected)/chat/+page.svelte"
      to: "addAttachment function"
      via: "isText detection using allowlist + extension"
      pattern: "KNOWN_TEXT_FILENAMES.has"
---

<objective>
Fix extensionless text file rejection in chat attachments by adding a filename-based allowlist for known text files.

Purpose: Files like README, Makefile, Dockerfile, LICENSE are valid text files but currently rejected because extension-based detection fails when there's no extension (split('.').pop() returns the full filename like 'README', which isn't in TEXT_EXTENSIONS).

Output: Chat accepts extensionless text files by checking against a known filenames allowlist before falling back to extension-based detection.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-bug-fixes-stability/06-gap-closure-UAT.md (gap definition)
@frontend/src/routes/(protected)/chat/+page.svelte (TEXT_EXTENSIONS at line 11, addAttachment at line 135)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add extensionless text file detection</name>
  <files>frontend/src/routes/(protected)/chat/+page.svelte</files>
  <action>
    Add an allowlist of known extensionless text filenames and update the addAttachment
    function to check it when the file has no extension.

    1. Add a new Set after TEXT_EXTENSIONS (around line 15):
       ```typescript
       // Known text filenames without extensions
       const KNOWN_TEXT_FILENAMES = new Set([
           'readme', 'makefile', 'dockerfile', 'license', 'procfile',
           'gemfile', 'brewfile', 'vagrantfile', 'rakefile', 'guardfile',
           'podfile', 'fastfile', 'dangerfile', 'berksfile', 'thorfile',
           'capfile', 'puppetfile', 'appraisals', 'codeowners',
           'changelog', 'contributing', 'authors', 'todo', 'copying',
           'notice', 'patents', 'version', 'manifest'
       ]);
       ```

    2. Update the extension extraction and isText detection in addAttachment (around line 143-144):

       Replace:
       ```typescript
       const ext = file.name.split('.').pop()?.toLowerCase() || '';
       const isText = TEXT_EXTENSIONS.has(ext);
       ```

       With:
       ```typescript
       const nameParts = file.name.split('.');
       const hasExtension = nameParts.length > 1;
       const ext = hasExtension ? (nameParts.pop()?.toLowerCase() || '') : '';

       // Check extensionless filename allowlist OR extension-based detection
       const isText = hasExtension
           ? TEXT_EXTENSIONS.has(ext)
           : KNOWN_TEXT_FILENAMES.has(file.name.toLowerCase());
       ```

    3. Also add dotfiles to the allowlist detection. Common dotfiles that are text:
       Update the isText line to also check for dotfiles:
       ```typescript
       const isDotfile = file.name.startsWith('.') && !hasExtension;
       const isKnownDotfile = new Set([
           '.gitignore', '.dockerignore', '.editorconfig', '.env.example',
           '.npmrc', '.nvmrc', '.prettierrc', '.eslintrc', '.babelrc',
           '.gitattributes', '.mailmap'
       ]).has(file.name.toLowerCase());

       const isText = hasExtension
           ? TEXT_EXTENSIONS.has(ext)
           : (KNOWN_TEXT_FILENAMES.has(file.name.toLowerCase()) || isKnownDotfile);
       ```

       Or more cleanly, combine into the KNOWN_TEXT_FILENAMES set from the start by adding
       the dotfiles there. Update the allowlist in step 1 to include:
       ```typescript
       const KNOWN_TEXT_FILENAMES = new Set([
           // Standard extensionless files
           'readme', 'makefile', 'dockerfile', 'license', 'procfile',
           'gemfile', 'brewfile', 'vagrantfile', 'rakefile', 'guardfile',
           'podfile', 'fastfile', 'dangerfile', 'berksfile', 'thorfile',
           'capfile', 'puppetfile', 'appraisals', 'codeowners',
           'changelog', 'contributing', 'authors', 'todo', 'copying',
           'notice', 'patents', 'version', 'manifest',
           // Common dotfiles (also extensionless)
           '.gitignore', '.dockerignore', '.editorconfig', '.env.example',
           '.npmrc', '.nvmrc', '.prettierrc', '.eslintrc', '.babelrc',
           '.gitattributes', '.mailmap', '.env', '.env.local', '.env.development',
           '.env.production', '.env.test'
       ]);
       ```

       Then the isText check simplifies to:
       ```typescript
       const isText = hasExtension
           ? TEXT_EXTENSIONS.has(ext)
           : KNOWN_TEXT_FILENAMES.has(file.name.toLowerCase());
       ```

    4. Update the text attachment thumbnail display to handle extensionless files better.
       In the attachment preview section (around line 877), the display shows the extension:
       ```svelte
       <span class="truncate w-full text-center">{attachment.preview.split('.').pop()}</span>
       ```

       For extensionless files, this shows the full filename. That's fine since preview IS
       the filename for text files, but truncate will handle long names. No change needed
       here - it will display 'README', 'Makefile' etc. which is correct.
  </action>
  <verify>
    Run `cd /Users/atomasini/Development/mlx-manager/frontend && npm run check` to verify no type errors.
    Grep for "KNOWN_TEXT_FILENAMES" to confirm the allowlist exists.
    Grep for "hasExtension" to confirm the new detection logic is in place.
  </verify>
  <done>
    Extensionless text files (README, Makefile, Dockerfile, LICENSE, etc.) and common
    dotfiles (.gitignore, .dockerignore, etc.) are accepted as chat attachments using
    filename-based allowlist detection.
  </done>
</task>

</tasks>

<verification>
- `npm run check` passes in frontend
- KNOWN_TEXT_FILENAMES allowlist defined with common extensionless text filenames
- Extension detection checks hasExtension before using extension vs filename allowlist
- Dotfiles included in allowlist for comprehensive coverage
</verification>

<success_criteria>
- README, Makefile, Dockerfile, LICENSE attachable without error
- .gitignore, .dockerignore attachable without error
- Regular extension files (.md, .py, .js) still work via TEXT_EXTENSIONS
- Files with unknown extensions/names still rejected appropriately
</success_criteria>

<output>
After completion, create `.planning/phases/06-bug-fixes-stability/06-17-SUMMARY.md`
</output>
