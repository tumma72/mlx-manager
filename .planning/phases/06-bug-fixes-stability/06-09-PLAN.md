---
phase: 06-bug-fixes-stability
plan: 09
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/mlx_manager/routers/models.py
  - frontend/src/lib/api/client.ts
  - frontend/src/lib/stores/models.svelte.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Tool-use badge appears on models that have tool-use tags on HuggingFace"
    - "Tags are passed from frontend through API to detect_tool_use()"
  artifacts:
    - path: "backend/mlx_manager/routers/models.py"
      provides: "Config endpoint accepting tags query param"
      contains: "tags"
    - path: "frontend/src/lib/api/client.ts"
      provides: "getConfig sends tags query param"
      contains: "tags"
    - path: "frontend/src/lib/stores/models.svelte.ts"
      provides: "fetchConfig passes tags to API client"
      contains: "tags"
  key_links:
    - from: "frontend/src/lib/stores/models.svelte.ts"
      to: "frontend/src/lib/api/client.ts"
      via: "modelsApi.getConfig(modelId, tags)"
      pattern: "getConfig\\(modelId.*tags"
    - from: "frontend/src/lib/api/client.ts"
      to: "backend/mlx_manager/routers/models.py"
      via: "tags query parameter"
      pattern: "tags="
    - from: "backend/mlx_manager/routers/models.py"
      to: "backend/mlx_manager/utils/model_detection.py"
      via: "extract_characteristics(config, tags)"
      pattern: "extract_characteristics.*tags"
---

<objective>
Fix the tool-use badge not appearing by passing HuggingFace tags through the API chain to the detect_tool_use() function.

Purpose: Tool-use capable models need visible badges so users know which models support function calling
Output: Tags flow from frontend store -> API client -> backend endpoint -> detect_tool_use()
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@backend/mlx_manager/routers/models.py
@backend/mlx_manager/utils/model_detection.py
@frontend/src/lib/api/client.ts
@frontend/src/lib/stores/models.svelte.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Backend - Accept tags query parameter</name>
  <files>backend/mlx_manager/routers/models.py</files>
  <action>
    Modify the `get_model_config` endpoint (line 278-307) to accept an optional `tags` query parameter:

    1. Add `Query` import from fastapi if not present.
    2. Add parameter: `tags: str | None = Query(None, description="Comma-separated HuggingFace tags")`
    3. Parse tags into list: `tag_list = tags.split(",") if tags else None`
    4. Pass tags to both extraction functions:
       - Line 298: `chars = extract_characteristics_from_model(model_id, tags=tag_list)`
       - Line 305: `return extract_characteristics(config, tags=tag_list)`

    The `extract_characteristics_from_model` already accepts `tags` parameter (line 530). The `extract_characteristics` already accepts `tags` parameter (line 467). Both already pass tags to `detect_tool_use`. The only missing link is the endpoint not receiving and forwarding them.
  </action>
  <verify>
    Run `cd /Users/atomasini/Development/mlx-manager/backend && source .venv/bin/activate && ruff check mlx_manager/routers/models.py && mypy mlx_manager/routers/models.py --ignore-missing-imports`
  </verify>
  <done>
    - GET /api/models/config/{model_id}?tags=tool-use,chat accepts tags
    - Tags are forwarded to extract_characteristics_from_model() and extract_characteristics()
  </done>
</task>

<task type="auto">
  <name>Task 2: Frontend - Pass tags through API client and store</name>
  <files>
    frontend/src/lib/api/client.ts
    frontend/src/lib/stores/models.svelte.ts
  </files>
  <action>
    1. In client.ts, modify `getConfig` (line 298-305) to accept and forward tags:

    ```typescript
    getConfig: async (modelId: string, tags?: string[]): Promise<ModelCharacteristics> => {
      let url = `${API_BASE}/models/config/${modelId}`;
      if (tags && tags.length > 0) {
        url += `?tags=${encodeURIComponent(tags.join(','))}`;
      }
      const res = await fetch(url, {
        headers: getAuthHeaders(),
      });
      return handleResponse(res);
    },
    ```

    2. In models.svelte.ts, modify `fetchConfig` (line 161) to pass tags to the API client:

    Change line 161 from:
    ```typescript
    const characteristics = await modelsApi.getConfig(modelId);
    ```
    To:
    ```typescript
    const characteristics = await modelsApi.getConfig(modelId, tags.length > 0 ? tags : undefined);
    ```

    The `fetchConfig` method already receives `tags: string[] = []` as parameter (line 148). The store callers already pass tags when available. The only missing link is forwarding them to the API client.
  </action>
  <verify>
    Run `cd /Users/atomasini/Development/mlx-manager/frontend && npm run check` to verify TypeScript compiles.
  </verify>
  <done>
    - modelsApi.getConfig accepts optional tags array
    - Tags are URL-encoded as comma-separated query param
    - models store forwards tags from fetchConfig to API client
    - Tool-use badge appears for models with "tool-use" tag
  </done>
</task>

</tasks>

<verification>
- `cd /Users/atomasini/Development/mlx-manager/backend && source .venv/bin/activate && ruff check . && mypy mlx_manager --ignore-missing-imports`
- `cd /Users/atomasini/Development/mlx-manager/frontend && npm run check`
- grep confirms tags parameter in endpoint, API client, and store
</verification>

<success_criteria>
- Backend endpoint accepts ?tags=tool-use,chat query param
- Frontend API client sends tags when available
- Frontend store passes tags through to API client
- detect_tool_use() receives tags and returns true for "tool-use" tagged models
- ToolUseBadge renders for tool-use capable models
</success_criteria>

<output>
After completion, create `.planning/phases/06-bug-fixes-stability/06-09-SUMMARY.md`
</output>
