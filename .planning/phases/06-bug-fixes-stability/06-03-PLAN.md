---
phase: 06-bug-fixes-stability
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/mlx_manager/types.py
  - backend/mlx_manager/utils/model_detection.py
  - frontend/src/lib/api/types.ts
  - frontend/src/lib/components/models/ModelBadges.svelte
  - frontend/src/lib/components/models/badges/ToolUseBadge.svelte
autonomous: true

must_haves:
  truths:
    - "Models with tool-use capability show a 'Tool Use' badge on their card"
    - "Tool-use is detected from HuggingFace model tags (checking for 'tool-use', 'function-calling', etc.)"
    - "Badge follows existing visual pattern established by ArchitectureBadge, MultimodalBadge, QuantizationBadge"
  artifacts:
    - path: "frontend/src/lib/components/models/badges/ToolUseBadge.svelte"
      provides: "Tool-use badge component"
      min_lines: 10
    - path: "backend/mlx_manager/utils/model_detection.py"
      provides: "Tool-use detection logic"
      contains: "tool.use|function.call"
  key_links:
    - from: "frontend/src/lib/components/models/ModelBadges.svelte"
      to: "ToolUseBadge.svelte"
      via: "conditional rendering"
      pattern: "is_tool_use"
    - from: "backend/mlx_manager/utils/model_detection.py"
      to: "ModelCharacteristics"
      via: "is_tool_use field"
      pattern: "is_tool_use"
---

<objective>
Detect model tool-use capability from HuggingFace tags and display a visual badge on model cards.

Purpose: Help users quickly identify which models support function calling / tool use, enabling them to make informed choices for agentic workflows.
Output: New `is_tool_use` field in ModelCharacteristics; ToolUseBadge component; ModelBadges updated to show it.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@backend/mlx_manager/types.py
@backend/mlx_manager/utils/model_detection.py
@frontend/src/lib/components/models/ModelBadges.svelte
@frontend/src/lib/components/models/badges/ArchitectureBadge.svelte
@frontend/src/lib/api/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tool-use detection to backend model characteristics</name>
  <files>
    backend/mlx_manager/types.py
    backend/mlx_manager/utils/model_detection.py
  </files>
  <action>
    1. In `types.py`, add `is_tool_use: bool` field to `ModelCharacteristics` TypedDict (after `use_cache`).

    2. In `utils/model_detection.py`, update `extract_characteristics()` to detect tool-use capability. The detection should use BOTH approaches:

    a) **Tag-based detection** (primary): Check HuggingFace model tags for tool-use indicators. This requires passing tags to the extraction function. Add an optional `tags: list[str] | None = None` parameter. Check for any of these tag substrings (case-insensitive):
       - "tool-use"
       - "tool_use"
       - "function-calling"
       - "function_calling"
       - "tool-calling"
       - "tools"

    b) **Config-based detection** (fallback): Check if the model's config.json has `tool_call_parser`-related fields or if the architecture family is known to support tools (e.g., Qwen3, GLM-4, MiniMax models with appropriate parser settings).

    3. Also update the `extract_characteristics_from_model()` function to pass tags when available. If the model info includes tags from the snapshot metadata, use them.

    4. Update the models router endpoint that returns characteristics to pass tags from the HuggingFace search results when available. The `/api/models/local` endpoint already calls `extract_characteristics_from_model` — ensure it includes tag detection.

    Set `is_tool_use` in the returned characteristics dict.
  </action>
  <verify>
    Run `cd backend && ruff check . && ruff format --check . && mypy mlx_manager` — no errors.
    Run `pytest -v` — all tests pass.
    Test: Call the local models endpoint for a model known to support tools (e.g., Qwen3-Coder) and verify `is_tool_use: true` in characteristics.
  </verify>
  <done>ModelCharacteristics includes `is_tool_use` boolean field. Detection checks HuggingFace tags for tool-use keywords. Backend linting and tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Create ToolUseBadge and update ModelBadges</name>
  <files>
    frontend/src/lib/api/types.ts
    frontend/src/lib/components/models/badges/ToolUseBadge.svelte
    frontend/src/lib/components/models/ModelBadges.svelte
  </files>
  <action>
    1. In `types.ts`, add `is_tool_use?: boolean` to the `ModelCharacteristics` interface.

    2. Create `frontend/src/lib/components/models/badges/ToolUseBadge.svelte` following the pattern of existing badge components (ArchitectureBadge, MultimodalBadge, QuantizationBadge):
    ```svelte
    <script lang="ts">
      // No props needed - presence means tool-use is supported
    </script>

    <span class="inline-flex items-center gap-1 rounded-full bg-amber-100 px-2 py-0.5 text-xs font-medium text-amber-800 dark:bg-amber-900/30 dark:text-amber-300">
      <svg class="h-3 w-3" ...><!-- wrench/tool icon --></svg>
      Tool Use
    </span>
    ```
    Use an amber/orange color scheme to distinguish from existing badges (blue for architecture, purple for multimodal, green for quantization). Use a wrench or hammer icon from lucide (or inline SVG).

    3. Update `ModelBadges.svelte` to conditionally render the ToolUseBadge:
    ```svelte
    import ToolUseBadge from './badges/ToolUseBadge.svelte';

    <!-- After quantization badge -->
    {#if characteristics.is_tool_use}
      <ToolUseBadge />
    {/if}
    ```
  </action>
  <verify>
    Run `cd frontend && npm run check && npm run lint` — no errors.
    Run `npm run test` — all tests pass.
    Visual check: Model cards for tool-use capable models show an amber "Tool Use" badge.
  </verify>
  <done>ToolUseBadge component exists with amber styling. ModelBadges renders it when `is_tool_use` is true. Frontend builds and lints cleanly.</done>
</task>

</tasks>

<verification>
- Backend: `cd backend && ruff check . && mypy mlx_manager && pytest -v` all pass
- Frontend: `cd frontend && npm run check && npm run lint && npm run test` all pass
- Tool-use capable models display an amber "Tool Use" badge
- Non-tool-use models show no tool-use badge
</verification>

<success_criteria>
- `is_tool_use` field present in ModelCharacteristics (backend and frontend types)
- Detection works from HuggingFace model tags
- Badge displays correctly with amber color scheme
- All quality checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-bug-fixes-stability/06-03-SUMMARY.md`
</output>
