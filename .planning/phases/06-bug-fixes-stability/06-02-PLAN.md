---
phase: 06-bug-fixes-stability
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/lib/stores/servers.svelte.ts
  - frontend/src/lib/components/profiles/ProfileCard.svelte
autonomous: true

must_haves:
  truths:
    - "No console.log statements remain in production frontend code"
    - "Server status polling doesn't cause unnecessary component re-renders"
    - "Polling loops are properly deduplicated (no duplicate timers)"
  artifacts:
    - path: "frontend/src/lib/stores/servers.svelte.ts"
      provides: "Clean store without debug logging"
    - path: "frontend/src/lib/components/profiles/ProfileCard.svelte"
      provides: "Clean component without debug logging"
  key_links:
    - from: "frontend/src/lib/stores/servers.svelte.ts"
      to: "ProfileCard.svelte"
      via: "reactive store subscription"
      pattern: "serverStore\\."
---

<objective>
Remove all console.log debug statements from production frontend code and fix server status polling to prevent excessive re-renders.

Purpose: Eliminate noisy debug output in browser console and reduce unnecessary DOM updates during server status polling.
Output: Clean production code with no debug logs; efficient polling that only triggers re-renders on actual state changes.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/lib/stores/servers.svelte.ts
@frontend/src/lib/components/profiles/ProfileCard.svelte
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove all console.log debug statements</name>
  <files>
    frontend/src/lib/stores/servers.svelte.ts
    frontend/src/lib/components/profiles/ProfileCard.svelte
  </files>
  <action>
    Remove ALL `console.log(...)` statements from both files. These are debug statements added during Phase 2 development that should not be in production.

    **servers.svelte.ts** (~13 console.log calls):
    - Lines 228-265: Remove all console.log in `markStartupFailed()`
    - Lines 353-359: Remove console.log in `startProfilePolling()`
    - Line 369: Remove console.log in `stopProfilePolling()`

    **ProfileCard.svelte** (~25+ console.log calls):
    - Line 108: Remove "Resuming polling on mount" log
    - Lines 131-204: Remove ALL console.log calls in `pollServerStatus()` function
    - Lines 211-246: Remove ALL console.log calls in `handleStart()` function
    - Line 286: Remove "Could not start polling for restart" log

    Keep `console.error(...)` calls if any exist (those are legitimate error reporting). Only remove `console.log(...)`.
  </action>
  <verify>
    Run `cd frontend && grep -rn "console.log" src/lib/stores/servers.svelte.ts src/lib/components/profiles/ProfileCard.svelte` — should return no results.
    Run `npm run check` — no type errors.
    Run `npm run lint` — no lint errors.
  </verify>
  <done>Zero console.log statements remain in servers.svelte.ts and ProfileCard.svelte. Only legitimate console.error calls (if any) are preserved.</done>
</task>

<task type="auto">
  <name>Task 2: Fix polling to prevent excessive re-renders</name>
  <files>
    frontend/src/lib/stores/servers.svelte.ts
    frontend/src/lib/components/profiles/ProfileCard.svelte
  </files>
  <action>
    The polling re-render issue has two aspects:

    1. **Store-level deduplication**: In `servers.svelte.ts`, the `refresh()` method fetches server list from API and assigns to `this.servers`. Even if data hasn't changed, the assignment triggers Svelte reactivity. Fix by comparing new data with existing before assignment:

    ```typescript
    async refresh() {
      try {
        const newServers = await serversApi.list();
        // Only update if data actually changed (prevents re-renders)
        if (JSON.stringify(newServers) !== JSON.stringify(this.servers)) {
          this.servers = newServers;
        }
      } catch (e) {
        // ... error handling
      }
    }
    ```

    2. **Polling interval optimization in ProfileCard.svelte**: The current poll interval is likely a constant. Add early exit when status hasn't changed to avoid triggering reactive updates. The key change: only call `serverStore.markStartupFailed()` or `serverStore.markStartupComplete()` (or equivalent) when the status actually transitions, not on every poll cycle.

    Additionally, ensure the polling function in ProfileCard uses `setTimeout` (not `setInterval`) to prevent overlapping polls if a request takes longer than the interval.
  </action>
  <verify>
    Run `cd frontend && npm run check && npm run lint` — no errors.
    Run `npm run test` — all unit tests pass.
    Manual check: Start a server, observe that the Servers page doesn't flicker/re-render tiles constantly during polling.
  </verify>
  <done>Server status polling only triggers re-renders when actual state changes occur. No flickering during normal polling cycles.</done>
</task>

</tasks>

<verification>
- `cd frontend && npm run check && npm run lint && npm run test` all pass
- `grep -rn "console.log" src/lib/stores/ src/lib/components/profiles/` returns no results (in the specified files)
- Server page remains stable during polling (no visible flicker)
</verification>

<success_criteria>
- Zero console.log statements in servers store and ProfileCard component
- Polling does not cause visible re-renders when server state is unchanged
- All frontend checks and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-bug-fixes-stability/06-02-SUMMARY.md`
</output>
