import{c as U,a as d,f as T,t as Ae}from"./BwiJqY1Q.js";import{ai as bt,O as yt,f as k,p as ft,l as Ve,e as a,g as t,i as y,a as mt,s as o,d as r,t as Q,r as l,n as Y,u as Oe}from"./v4vcYSfj.js";import{d as gt,e as _t,s as E}from"./CYs-NoBq.js";import{l as _e,b as pe,p as st,i as A}from"./CQCzmFHa.js";import{I as he,b as xe,m as Pt,e as rt,r as St,s as v,k as wt,p as dt}from"./C9wz-uxy.js";import{C as pt,I as ge,S as Ke,B as J,b as kt}from"./BzOnXb-X.js";import{g as Mt}from"./B5G5TIqL.js";import{r as Ct}from"./DYpmv-gh.js";import{T as Tt,B as We,H as Ft,f as zt,C as Dt}from"./BX18nlpw.js";import"./QUEjkrZk.js";import{M as Nt,C as qt}from"./C0rtPYWr.js";import{L as ut}from"./CnEP7e_F.js";function Et(M,e,p,w,n){var x=()=>{w(p[M])};p.addEventListener(e,x),n?bt(()=>{p[M]=n()}):x(),(p===document.body||p===window||p===document)&&yt(()=>{p.removeEventListener(e,x)})}function ct(M,e){const p=_e(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"}]];he(M,pe({name:"activity"},()=>p,{get iconNode(){return w},children:(n,x)=>{var s=U(),f=k(s);xe(f,e,"default",{}),d(n,s)},$$slots:{default:!0}}))}function Lt(M,e){const p=_e(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["circle",{cx:"12",cy:"12",r:"10"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16"}]];he(M,pe({name:"circle-alert"},()=>p,{get iconNode(){return w},children:(n,x)=>{var s=U(),f=k(s);xe(f,e,"default",{}),d(n,s)},$$slots:{default:!0}}))}function Ot(M,e){const p=_e(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}]];he(M,pe({name:"clipboard"},()=>p,{get iconNode(){return w},children:(n,x)=>{var s=U(),f=k(s);xe(f,e,"default",{}),d(n,s)},$$slots:{default:!0}}))}function At(M,e){const p=_e(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];he(M,pe({name:"copy"},()=>p,{get iconNode(){return w},children:(n,x)=>{var s=U(),f=k(s);xe(f,e,"default",{}),d(n,s)},$$slots:{default:!0}}))}function It(M,e){const p=_e(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];he(M,pe({name:"play"},()=>p,{get iconNode(){return w},children:(n,x)=>{var s=U(),f=k(s);xe(f,e,"default",{}),d(n,s)},$$slots:{default:!0}}))}function Rt(M,e){const p=_e(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}]];he(M,pe({name:"rotate-cw"},()=>p,{get iconNode(){return w},children:(n,x)=>{var s=U(),f=k(s);xe(f,e,"default",{}),d(n,s)},$$slots:{default:!0}}))}function Ht(M,e){const p=_e(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"}]];he(M,pe({name:"square-pen"},()=>p,{get iconNode(){return w},children:(n,x)=>{var s=U(),f=k(s);xe(f,e,"default",{}),d(n,s)},$$slots:{default:!0}}))}function vt(M,e){const p=_e(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}]];he(M,pe({name:"square"},()=>p,{get iconNode(){return w},children:(n,x)=>{var s=U(),f=k(s);xe(f,e,"default",{}),d(n,s)},$$slots:{default:!0}}))}var Ut=T("<option>Language Model (lm)</option> <option>Multimodal (Vision)</option>",1),Bt=T('<span class="text-xs text-muted-foreground">Detecting...</span>'),Qt=T('<span class="text-xs text-green-600"> </span>'),Vt=T("<option> </option>"),jt=T("<option> </option>"),Gt=T("<option> </option>"),Jt=T('<div class="space-y-4 pt-4 border-t"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="host" class="block text-sm font-medium mb-1">Host</label> <!></div> <div><label for="maxConcurrency" class="block text-sm font-medium mb-1">Max Concurrency</label> <!></div></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="queueTimeout" class="block text-sm font-medium mb-1">Queue Timeout (seconds)</label> <!></div> <div><label for="queueSize" class="block text-sm font-medium mb-1">Queue Size</label> <!></div></div> <div class="pt-4 border-t"><div class="flex items-center gap-2 mb-3"><h3 class="text-sm font-medium">Model-Specific Parsers</h3> <!></div> <p class="text-xs text-muted-foreground mb-3">Required for MiniMax, Qwen3, and GLM models to enable tool calling and reasoning.</p> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label for="toolCallParser" class="block text-sm font-medium mb-1">Tool Call Parser</label> <!></div> <div><label for="reasoningParser" class="block text-sm font-medium mb-1">Reasoning Parser</label> <!></div> <div><label for="messageConverter" class="block text-sm font-medium mb-1">Message Converter</label> <!></div></div></div> <div class="space-y-2"><label class="flex items-center gap-2"><input type="checkbox" class="rounded"/> <span class="text-sm">Start on Login (launchd)</span></label></div></div>'),Kt=T('<div class="mt-4 text-sm text-red-500"> </div>'),Wt=T('<h2 class="text-xl font-semibold mb-6"> </h2> <div class="space-y-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="name" class="block text-sm font-medium mb-1">Name *</label> <!></div> <div><label for="port" class="block text-sm font-medium mb-1">Port *</label> <!></div></div> <div><label for="description" class="block text-sm font-medium mb-1">Description</label> <!></div> <div><label for="modelPath" class="block text-sm font-medium mb-1">Model Path *</label> <!></div> <div><label for="modelType" class="block text-sm font-medium mb-1">Model Type</label> <!></div> <div class="pt-4"><button type="button" class="text-sm text-primary hover:underline"> </button></div> <!></div> <!> <div class="mt-6 flex justify-end gap-3"><!> <!></div>',1),Xt=T("<form><!></form>");function ba(M,e){ft(e,!0);let p=st(e,"nextPort",3,10240),w=st(e,"initialModelPath",3,""),n=y(!1),x=y(null),s=y(!1),f=y(null),be=y(""),Z=y(""),le=y(""),G=y("lm"),$=y(10240),ee=y("127.0.0.1"),oe=y(1),ie=y(300),Me=y(100),ne=y(!1),se=y(""),te=y(""),V=y(""),Ce=y(!1);const Te=[{value:"",label:"Default"},{value:"minimax_m2",label:"MiniMax M2"},{value:"qwen3",label:"Qwen3"},{value:"glm4",label:"GLM4"},{value:"hermes",label:"Hermes"},{value:"llama",label:"Llama"},{value:"mistral",label:"Mistral"}];Ve(()=>{var b,ae,K,de,W,ue,re,ze,ye,De,ce,Pe,ve;a(be,((b=e.profile)==null?void 0:b.name)??"",!0),a(Z,((ae=e.profile)==null?void 0:ae.description)??"",!0),a(le,((K=e.profile)==null?void 0:K.model_path)??w(),!0);const g=((de=e.profile)==null?void 0:de.model_type)??"lm";a(G,["lm","multimodal"].includes(g)?g:"lm",!0),a($,((W=e.profile)==null?void 0:W.port)??p(),!0),a(ee,((ue=e.profile)==null?void 0:ue.host)??"127.0.0.1",!0),a(oe,((re=e.profile)==null?void 0:re.max_concurrency)??1,!0),a(ie,((ze=e.profile)==null?void 0:ze.queue_timeout)??300,!0),a(Me,((ye=e.profile)==null?void 0:ye.queue_size)??100,!0),a(ne,((De=e.profile)==null?void 0:De.auto_start)??!1,!0),a(se,((ce=e.profile)==null?void 0:ce.tool_call_parser)??"",!0),a(te,((Pe=e.profile)==null?void 0:Pe.reasoning_parser)??"",!0),a(V,((ve=e.profile)==null?void 0:ve.message_converter)??"",!0)});async function Xe(g){if(!g){a(f,null);return}a(s,!0);try{const b=await Pt.detectOptions(g);a(f,b.model_family,!0),b.recommended_options&&(!t(se)&&b.recommended_options.tool_call_parser&&a(se,b.recommended_options.tool_call_parser,!0),!t(te)&&b.recommended_options.reasoning_parser&&a(te,b.recommended_options.reasoning_parser,!0),!t(V)&&b.recommended_options.message_converter&&a(V,b.recommended_options.message_converter,!0))}catch{a(f,null)}finally{a(s,!1)}}let Ie=null;Ve(()=>{t(le)&&!e.profile&&(Ie&&clearTimeout(Ie),Ie=setTimeout(()=>Xe(t(le)),500))});async function Ye(g){g.preventDefault(),a(n,!0),a(x,null);try{const b={name:t(be),description:t(Z)||void 0,model_path:t(le),model_type:t(G),port:t($),host:t(ee),max_concurrency:t(oe),queue_timeout:t(ie),queue_size:t(Me),auto_start:t(ne),tool_call_parser:t(se)||void 0,reasoning_parser:t(te)||void 0,message_converter:t(V)||void 0};await e.onSubmit(b)}catch(b){a(x,b instanceof Error?b.message:"Failed to save profile",!0)}finally{a(n,!1)}}var Fe=Xt(),c=r(Fe);pt(c,{class:"p-6",children:(g,b)=>{var ae=Wt(),K=k(ae),de=r(K,!0);l(K);var W=o(K,2),ue=r(W),re=r(ue),ze=o(r(re),2);ge(ze,{id:"name",placeholder:"e.g., Coding Assistant",required:!0,get value(){return t(be)},set value(P){a(be,P,!0)}}),l(re);var ye=o(re,2),De=o(r(ye),2);ge(De,{id:"port",type:"number",required:!0,get value(){return t($)},set value(P){a($,P,!0)}}),l(ye),l(ue);var ce=o(ue,2),Pe=o(r(ce),2);ge(Pe,{id:"description",placeholder:"Optional description",get value(){return t(Z)},set value(P){a(Z,P,!0)}}),l(ce);var ve=o(ce,2),je=o(r(ve),2);ge(je,{id:"modelPath",placeholder:"e.g., mlx-community/Qwen2.5-Coder-32B-Instruct-4bit",required:!0,get value(){return t(le)},set value(P){a(le,P,!0)}}),l(ve);var Ne=o(ve,2),Ze=o(r(Ne),2);Ke(Ze,{id:"modelType",get value(){return t(G)},set value(P){a(G,P,!0)},children:(P,j)=>{var i=Ut(),u=k(i);u.value=u.__value="lm";var h=o(u,2);h.value=h.__value="multimodal",d(P,i)},$$slots:{default:!0}}),l(Ne);var qe=o(Ne,2),Ee=r(qe);Ee.__click=()=>a(Ce,!t(Ce));var $e=r(Ee);l(Ee),l(qe);var et=o(qe,2);{var Ge=P=>{var j=Jt(),i=r(j),u=r(i),h=o(r(u),2);ge(h,{id:"host",get value(){return t(ee)},set value(_){a(ee,_,!0)}}),l(u);var C=o(u,2),O=o(r(C),2);ge(O,{id:"maxConcurrency",type:"number",get value(){return t(oe)},set value(_){a(oe,_,!0)}}),l(C),l(i);var m=o(i,2),S=r(m),D=o(r(S),2);ge(D,{id:"queueTimeout",type:"number",get value(){return t(ie)},set value(_){a(ie,_,!0)}}),l(S);var F=o(S,2),L=o(r(F),2);ge(L,{id:"queueSize",type:"number",get value(){return t(Me)},set value(_){a(Me,_,!0)}}),l(F),l(m);var N=o(m,2),I=r(N),z=o(r(I),2);{var Ue=_=>{var we=Bt();d(_,we)},Le=_=>{var we=U(),X=k(we);{var ke=R=>{var H=Qt(),q=r(H);l(H),Q(()=>E(q,`Detected: ${t(f)??""}`)),d(R,H)};A(X,R=>{t(f)&&R(ke)},!0)}d(_,we)};A(z,_=>{t(s)?_(Ue):_(Le,!1)})}l(I);var Se=o(I,4),fe=r(Se),Be=o(r(fe),2);Ke(Be,{id:"toolCallParser",get value(){return t(se)},set value(_){a(se,_,!0)},children:(_,we)=>{var X=U(),ke=k(X);rt(ke,17,()=>Te,R=>R.value,(R,H)=>{var q=Vt(),Qe=r(q,!0);l(q);var me={};Q(()=>{E(Qe,t(H).label),me!==(me=t(H).value)&&(q.value=(q.__value=t(H).value)??"")}),d(R,q)}),d(_,X)},$$slots:{default:!0}}),l(fe);var B=o(fe,2),ht=o(r(B),2);Ke(ht,{id:"reasoningParser",get value(){return t(te)},set value(_){a(te,_,!0)},children:(_,we)=>{var X=U(),ke=k(X);rt(ke,17,()=>Te,R=>R.value,(R,H)=>{var q=jt(),Qe=r(q,!0);l(q);var me={};Q(()=>{E(Qe,t(H).label),me!==(me=t(H).value)&&(q.value=(q.__value=t(H).value)??"")}),d(R,q)}),d(_,X)},$$slots:{default:!0}}),l(B);var lt=o(B,2),xt=o(r(lt),2);Ke(xt,{id:"messageConverter",get value(){return t(V)},set value(_){a(V,_,!0)},children:(_,we)=>{var X=U(),ke=k(X);rt(ke,17,()=>Te,R=>R.value,(R,H)=>{var q=Gt(),Qe=r(q,!0);l(q);var me={};Q(()=>{E(Qe,t(H).label),me!==(me=t(H).value)&&(q.value=(q.__value=t(H).value)??"")}),d(R,q)}),d(_,X)},$$slots:{default:!0}}),l(lt),l(Se),l(N);var ot=o(N,2),it=r(ot),nt=r(it);St(nt),Y(2),l(it),l(ot),l(j),kt(nt,()=>t(ne),_=>a(ne,_)),d(P,j)};A(et,P=>{t(Ce)&&P(Ge)})}l(W);var Re=o(W,2);{var tt=P=>{var j=Kt(),i=r(j,!0);l(j),Q(()=>E(i,t(x))),d(P,j)};A(Re,P=>{t(x)&&P(tt)})}var He=o(Re,2),Je=r(He);J(Je,{variant:"outline",get onclick(){return e.onCancel},get disabled(){return t(n)},children:(P,j)=>{Y();var i=Ae("Cancel");d(P,i)},$$slots:{default:!0}});var at=o(Je,2);J(at,{type:"submit",get disabled(){return t(n)},children:(P,j)=>{Y();var i=Ae();Q(()=>E(i,t(n)?"Saving...":e.profile?"Update Profile":"Create Profile")),d(P,i)},$$slots:{default:!0}}),l(He),Q(()=>{E(de,e.profile?"Edit Profile":"Create Profile"),E($e,`${t(Ce)?"Hide":"Show"} Advanced Options`)}),d(g,ae)},$$slots:{default:!0}}),l(Fe),_t("submit",Fe,Ye),d(M,Fe),mt()}gt(["click"]);var Yt=T('<p class="text-sm text-muted-foreground mt-1"> </p>'),Zt=T("<!> Chat",1),$t=T("<!> <!> <!>",1),ea=T("<!> Starting",1),ta=T("<!> <!>",1),aa=T("<!> Start",1),ra=T('<div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"><div class="flex items-center gap-2"><!> <span class="text-muted-foreground">Port:</span> <span class="font-mono"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-muted-foreground">PID:</span> <span class="font-mono"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-muted-foreground">Memory:</span> <span> </span></div> <div class="flex items-center gap-2"><span class="text-muted-foreground">Uptime:</span> <span> </span></div></div>'),la=T('<div class="mt-3 flex items-center gap-4 text-sm text-muted-foreground"><div class="flex items-center gap-2"><!> <span>Port:</span> <span class="font-mono"> </span></div> <div class="flex items-center gap-2"><span>Type:</span> <span> </span></div></div>'),oa=T('<details class="mt-2"><summary class="text-xs text-red-500 dark:text-red-400 cursor-pointer hover:underline">Show server log</summary> <div class="mt-2 relative"><button class="absolute top-2 right-2 p-1.5 rounded bg-red-200 dark:bg-red-800 hover:bg-red-300 dark:hover:bg-red-700 transition-colors" title="Copy to clipboard"><!></button> <pre class="text-xs text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900/50 p-2 pr-10 rounded overflow-x-auto max-h-48 whitespace-pre-wrap font-mono"> </pre></div></details>'),ia=T('<div class="mt-3 p-3 bg-red-50 dark:bg-red-950/50 rounded-lg border border-red-200 dark:border-red-900"><div class="flex items-start gap-2"><!> <div class="flex-1 min-w-0"><p class="text-sm text-red-600 dark:text-red-400 font-medium"> </p> <!></div></div></div>'),na=T('<div class="flex items-start justify-between gap-4"><div class="flex-1 min-w-0"><div class="flex items-center gap-2 flex-wrap"><h3 class="font-semibold text-lg"> </h3> <!> <!></div> <!> <div class="mt-2 text-sm text-muted-foreground truncate"><span class="font-mono"> </span></div></div> <div class="flex items-center gap-2 flex-shrink-0"><!> <!> <!> <!></div></div> <!> <!>',1);function ya(M,e){ft(e,!0);const p=12e4,w=2e3;let n=y(!1),x=y(null),s=y(null),f=y(!1);const be=Oe(()=>v.isStarting(e.profile.id)),Z=Oe(()=>v.isRunning(e.profile.id)),le=Oe(()=>v.isFailed(e.profile.id)),G=Oe(()=>v.getFailure(e.profile.id)),$=Oe(()=>e.server||v.getServer(e.profile.id));let ee=y(!1),oe=!1,ie=y(null);Ve(()=>{const c=v.getFailure(e.profile.id);c&&t(ie)!==e.profile.id?(a(ie,e.profile.id,!0),oe=!0,a(ee,c.detailsOpen,!0),requestAnimationFrame(()=>{oe=!1})):c||(a(ie,null),a(ee,!1))});function Me(){oe||v.toggleDetailsOpen(e.profile.id)}let ne=y(!1);async function se(){var c;if((c=t(G))!=null&&c.details)try{await navigator.clipboard.writeText(t(G).details),a(ne,!0),setTimeout(()=>{a(ne,!1)},2e3)}catch(g){console.error("Failed to copy to clipboard:",g)}}let te=y(!1);Ve(()=>{t(te)||(a(te,!0),v.isStarting(e.profile.id)&&!v.isProfilePolling(e.profile.id)&&(console.log(`[${e.profile.name}] Resuming polling on mount (component recreated while starting)`),v.startProfilePolling(e.profile.id)&&(a(f,!0),a(x,Date.now(),!0),V())))}),Ve(()=>()=>{t(s)&&(clearTimeout(t(s)),a(s,null))});async function V(){if(console.log(`[${e.profile.name}] pollServerStatus - isPolling=${t(f)}, startTime=${t(x)}`),!t(f)){console.log(`[${e.profile.name}] Polling stopped (isPolling=false)`),v.stopProfilePolling(e.profile.id);return}if(t(x)&&Date.now()-t(x)>p){console.log(`[${e.profile.name}] TIMEOUT after 2 minutes`),v.markStartupFailed(e.profile.id,"Model loading timed out after 2 minutes. Check server logs for details."),a(f,!1),a(s,null),v.stopProfilePolling(e.profile.id);return}try{console.log(`[${e.profile.name}] Calling serversApi.status...`);const c=await wt.status(e.profile.id);if(console.log(`[${e.profile.name}] Status:`,JSON.stringify(c)),!c.running){console.log(`[${e.profile.name}] Server NOT running - failed=${c.failed}`),c.failed?(console.log(`[${e.profile.name}] Marking as FAILED`),v.markStartupFailed(e.profile.id,"Server crashed while loading model",c.error_message||"Server process exited unexpectedly")):(console.log(`[${e.profile.name}] Marking as SUCCESS (graceful stop)`),v.markStartupSuccess(e.profile.id)),a(f,!1),a(s,null),v.stopProfilePolling(e.profile.id);return}console.log(`[${e.profile.name}] Server IS running, checking model endpoint...`);try{const g=await fetch(`http://${e.profile.host}:${e.profile.port}/v1/models`);if(console.log(`[${e.profile.name}] Model endpoint response: ${g.status}`),g.ok){const b=await g.json();if(console.log(`[${e.profile.name}] Model data:`,JSON.stringify(b)),b.data&&b.data.length>0){console.log(`[${e.profile.name}] Model LOADED - marking success`),v.markStartupSuccess(e.profile.id),a(f,!1),a(s,null),v.stopProfilePolling(e.profile.id);return}}}catch(g){console.log(`[${e.profile.name}] Model endpoint error (expected during startup):`,g)}console.log(`[${e.profile.name}] Scheduling next poll in ${w}ms`),a(s,setTimeout(V,w),!0)}catch(c){console.log(`[${e.profile.name}] Status API error:`,c),a(s,setTimeout(V,w),!0)}}async function Ce(){if(console.log(`[${e.profile.name}] handleStart called`),a(n,!0),v.clearFailure(e.profile.id),a(x,Date.now(),!0),t(s)&&(clearTimeout(t(s)),a(s,null)),!v.startProfilePolling(e.profile.id)){console.log(`[${e.profile.name}] Another polling loop already active, not starting a new one`),a(n,!1);return}a(f,!0);try{console.log(`[${e.profile.name}] Calling serverStore.start...`),await v.start(e.profile.id),console.log(`[${e.profile.name}] serverStore.start completed, starting polling`),V()}catch(c){console.log(`[${e.profile.name}] Start failed:`,c);const g=c instanceof Error?c.message:"Failed to start server";v.markStartupFailed(e.profile.id,g),a(x,null),a(f,!1),v.stopProfilePolling(e.profile.id)}finally{a(n,!1),console.log(`[${e.profile.name}] handleStart finished`)}}async function Te(){a(n,!0),a(x,null),a(f,!1),t(s)&&(clearTimeout(t(s)),a(s,null)),v.stopProfilePolling(e.profile.id);try{await v.stop(e.profile.id)}catch(c){const g=c instanceof Error?c.message:"Failed to stop server";v.markStartupFailed(e.profile.id,g)}finally{a(n,!1)}}async function Xe(){if(a(n,!0),v.clearFailure(e.profile.id),a(x,Date.now(),!0),t(s)&&(clearTimeout(t(s)),a(s,null)),v.stopProfilePolling(e.profile.id),!v.startProfilePolling(e.profile.id)){console.log(`[${e.profile.name}] Could not start polling for restart`),a(n,!1);return}a(f,!0);try{await v.restart(e.profile.id),V()}catch(c){const g=c instanceof Error?c.message:"Failed to restart server";v.markStartupFailed(e.profile.id,g),a(x,null),a(f,!1),v.stopProfilePolling(e.profile.id)}finally{a(n,!1)}}async function Ie(){if(confirm("Are you sure you want to delete this profile?")){a(n,!0),v.clearFailure(e.profile.id);try{t(Z)&&await v.stop(e.profile.id),await dt.delete(e.profile.id)}catch(c){const g=c instanceof Error?c.message:"Failed to delete profile";v.markStartupFailed(e.profile.id,g)}finally{a(n,!1)}}}async function Ye(){const c=prompt("Enter name for the duplicate profile:",`${e.profile.name} (copy)`);if(c){a(n,!0);try{await dt.duplicate(e.profile.id,c)}catch(g){const b=g instanceof Error?g.message:"Failed to duplicate profile";alert(b)}finally{a(n,!1)}}}async function Fe(){const c=`${Ct("/chat")}?profile=${e.profile.id}`;await Mt(c)}pt(M,{class:"p-4",children:(c,g)=>{var b=na(),ae=k(b),K=r(ae),de=r(K),W=r(de),ue=r(W,!0);l(W);var re=o(W,2);{var ze=i=>{We(i,{variant:"destructive",children:(u,h)=>{Y();var C=Ae("Error");d(u,C)},$$slots:{default:!0}})},ye=i=>{var u=U(),h=k(u);{var C=m=>{We(m,{variant:"success",children:(S,D)=>{Y();var F=Ae("Running");d(S,F)},$$slots:{default:!0}})},O=m=>{var S=U(),D=k(S);{var F=L=>{We(L,{variant:"warning",children:(N,I)=>{Y();var z=Ae("Loading...");d(N,z)},$$slots:{default:!0}})};A(D,L=>{t(be)&&L(F)},!0)}d(m,S)};A(h,m=>{t(Z)?m(C):m(O,!1)},!0)}d(i,u)};A(re,i=>{t(le)?i(ze):i(ye,!1)})}var De=o(re,2);{var ce=i=>{We(i,{variant:"outline",children:(u,h)=>{Y();var C=Ae("launchd");d(u,C)},$$slots:{default:!0}})};A(De,i=>{e.profile.launchd_installed&&i(ce)})}l(de);var Pe=o(de,2);{var ve=i=>{var u=Yt(),h=r(u,!0);l(u),Q(()=>E(h,e.profile.description)),d(i,u)};A(Pe,i=>{e.profile.description&&i(ve)})}var je=o(Pe,2),Ne=r(je),Ze=r(Ne,!0);l(Ne),l(je),l(K);var qe=o(K,2),Ee=r(qe);{var $e=i=>{var u=$t(),h=k(u);J(h,{variant:"default",size:"sm",onclick:Fe,get disabled(){return t(n)},title:"Chat with model",children:(m,S)=>{var D=Zt(),F=k(D);Nt(F,{class:"w-4 h-4 mr-1"}),Y(),d(m,D)},$$slots:{default:!0}});var C=o(h,2);J(C,{variant:"outline",size:"icon",onclick:Te,get disabled(){return t(n)},title:"Stop",children:(m,S)=>{vt(m,{class:"w-4 h-4"})},$$slots:{default:!0}});var O=o(C,2);J(O,{variant:"outline",size:"icon",onclick:Xe,get disabled(){return t(n)},title:"Restart",children:(m,S)=>{Rt(m,{class:"w-4 h-4"})},$$slots:{default:!0}}),d(i,u)},et=i=>{var u=U(),h=k(u);{var C=m=>{var S=ta(),D=k(S);J(D,{variant:"default",size:"sm",disabled:!0,title:"Starting...",children:(L,N)=>{var I=ea(),z=k(I);ut(z,{class:"w-4 h-4 mr-1 animate-spin"}),Y(),d(L,I)},$$slots:{default:!0}});var F=o(D,2);J(F,{variant:"outline",size:"icon",onclick:Te,get disabled(){return t(n)},title:"Cancel",children:(L,N)=>{vt(L,{class:"w-4 h-4"})},$$slots:{default:!0}}),d(m,S)},O=m=>{J(m,{variant:"default",size:"sm",onclick:Ce,get disabled(){return t(n)},title:"Start",children:(S,D)=>{var F=aa(),L=k(F);{var N=z=>{ut(z,{class:"w-4 h-4 mr-1 animate-spin"})},I=z=>{It(z,{class:"w-4 h-4 mr-1"})};A(L,z=>{t(n)?z(N):z(I,!1)})}Y(),d(S,F)},$$slots:{default:!0}})};A(h,m=>{t(be)?m(C):m(O,!1)},!0)}d(i,u)};A(Ee,i=>{t(Z)?i($e):i(et,!1)})}var Ge=o(Ee,2);{let i=Oe(()=>`/profiles/${e.profile.id}`);J(Ge,{variant:"outline",size:"icon",get href(){return t(i)},title:"Edit",children:(u,h)=>{Ht(u,{class:"w-4 h-4"})},$$slots:{default:!0}})}var Re=o(Ge,2);J(Re,{variant:"outline",size:"icon",onclick:Ye,get disabled(){return t(n)},title:"Duplicate",children:(i,u)=>{At(i,{class:"w-4 h-4"})},$$slots:{default:!0}});var tt=o(Re,2);J(tt,{variant:"outline",size:"icon",onclick:Ie,get disabled(){return t(n)},title:"Delete",children:(i,u)=>{Tt(i,{class:"w-4 h-4"})},$$slots:{default:!0}}),l(qe),l(ae);var He=o(ae,2);{var Je=i=>{var u=ra(),h=r(u),C=r(h);ct(C,{class:"w-4 h-4 text-muted-foreground"});var O=o(C,4),m=r(O,!0);l(O),l(h);var S=o(h,2),D=r(S);qt(D,{class:"w-4 h-4 text-muted-foreground"});var F=o(D,4),L=r(F,!0);l(F),l(S);var N=o(S,2),I=r(N);Ft(I,{class:"w-4 h-4 text-muted-foreground"});var z=o(I,4),Ue=r(z);l(z),l(N);var Le=o(N,2),Se=o(r(Le),2),fe=r(Se,!0);l(Se),l(Le),l(u),Q((Be,B)=>{E(m,e.profile.port),E(L,t($).pid),E(Ue,`${Be??""} MB`),E(fe,B)},[()=>t($).memory_mb.toFixed(1),()=>zt(t($).uptime_seconds)]),d(i,u)},at=i=>{var u=la(),h=r(u),C=r(h);ct(C,{class:"w-4 h-4"});var O=o(C,4),m=r(O,!0);l(O),l(h);var S=o(h,2),D=o(r(S),2),F=r(D,!0);l(D),l(S),l(u),Q(()=>{E(m,e.profile.port),E(F,e.profile.model_type)}),d(i,u)};A(He,i=>{t($)&&t(Z)?i(Je):i(at,!1)})}var P=o(He,2);{var j=i=>{var u=ia(),h=r(u),C=r(h);Lt(C,{class:"w-4 h-4 text-red-500 mt-0.5 flex-shrink-0"});var O=o(C,2),m=r(O),S=r(m,!0);l(m);var D=o(m,2);{var F=L=>{var N=oa(),I=o(r(N),2),z=r(I);z.__click=se;var Ue=r(z);{var Le=B=>{Dt(B,{class:"w-3.5 h-3.5 text-green-600 dark:text-green-400"})},Se=B=>{Ot(B,{class:"w-3.5 h-3.5 text-red-600 dark:text-red-300"})};A(Ue,B=>{t(ne)?B(Le):B(Se,!1)})}l(z);var fe=o(z,2),Be=r(fe,!0);l(fe),l(I),l(N),Q(()=>E(Be,t(G).details)),_t("toggle",N,Me),Et("open","toggle",N,B=>a(ee,B),()=>t(ee)),d(L,N)};A(D,L=>{t(G).details&&L(F)})}l(O),l(h),l(u),Q(()=>E(S,t(G).error)),d(i,u)};A(P,i=>{t(G)&&i(j)})}Q(()=>{E(ue,e.profile.name),E(Ze,e.profile.model_path)}),d(c,b)},$$slots:{default:!0}}),mt()}gt(["click"]);export{ya as P,ba as a};
