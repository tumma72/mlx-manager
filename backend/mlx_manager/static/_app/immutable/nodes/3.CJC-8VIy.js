import{b as $e,d as Qe,c as K,a as o,f as _,t as xe}from"../chunks/BwiJqY1Q.js";import{t as L,h as ye,c as be,U as We,aI as Xe,G as we,al as Ze,aA as et,aH as tt,aB as rt,M as at,ab as Z,f as E,p as Te,d as r,r as a,a as je,g as e,u as J,i as V,_ as st,o as ot,e as x,s as p,n as oe}from"../chunks/v4vcYSfj.js";import{s as Y,e as nt}from"../chunks/CYs-NoBq.js";import{l as de,b as ve,p as it,i as j,s as lt,a as dt}from"../chunks/CQCzmFHa.js";import{I as ce,b as fe,f as le,p as ke,s as Me,e as Pe}from"../chunks/C9wz-uxy.js";import{p as vt}from"../chunks/BkErw6yd.js";import{d as Se,S as ct,B as ne,C as ie,I as ft,T as ut}from"../chunks/BzOnXb-X.js";import"../chunks/QUEjkrZk.js";import{L as Ne}from"../chunks/CnEP7e_F.js";function pt(N,f,w=!1,k=!1,M=!1){var n=N,i="";L(()=>{var d=We;if(i===(i=f()??"")){ye&&be();return}if(d.nodes!==null&&(Xe(d.nodes.start,d.nodes.end),d.nodes=null),i!==""){if(ye){we.data;for(var u=be(),B=u;u!==null&&(u.nodeType!==Ze||u.data!=="");)B=u,u=et(u);if(u===null)throw tt(),rt;$e(we,B),n=at(u);return}var I=i+"";w?I=`<svg>${I}</svg>`:k&&(I=`<math>${I}</math>`);var h=Qe(I);if((w||k)&&(h=Z(h)),$e(Z(h),h.lastChild),w||k)for(;Z(h);)n.before(Z(h));else n.before(h)}})}function q(N,f){const w=de(f,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=[["path",{d:"M12 8V4H8"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2"}],["path",{d:"M2 14h2"}],["path",{d:"M20 14h2"}],["path",{d:"M15 13v2"}],["path",{d:"M9 13v2"}]];ce(N,ve({name:"bot"},()=>w,{get iconNode(){return k},children:(M,n)=>{var i=K(),d=E(i);fe(d,f,"default",{}),o(M,i)},$$slots:{default:!0}}))}function _t(N,f){const w=de(f,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];ce(N,ve({name:"send"},()=>w,{get iconNode(){return k},children:(M,n)=>{var i=K(),d=E(i);fe(d,f,"default",{}),o(M,i)},$$slots:{default:!0}}))}function ht(N,f){const w=de(f,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}],["circle",{cx:"12",cy:"7",r:"4"}]];ce(N,ve({name:"user"},()=>w,{get iconNode(){return k},children:(M,n)=>{var i=K(),d=E(i);fe(d,f,"default",{}),o(M,i)},$$slots:{default:!0}}))}var mt=_("<div><!></div>");function gt(N,f){Te(f,!0);let w=it(f,"class",3,"");Se.setOptions({breaks:!0,gfm:!0});const k=J(()=>Se.parse(f.content));var M=mt(),n=r(M);pt(n,()=>e(k)),a(M),L(()=>le(M,1,`prose prose-sm dark:prose-invert max-w-none ${w()??""}`)),o(N,M),je()}var $t=_("<option> </option>"),xt=_("<option>Select a running server...</option> <!>",1),yt=_('<div class="text-center"><!> <p class="text-muted-foreground mb-4">No servers running.</p> <!></div>'),bt=_('<div class="text-center"><!> <p class="text-muted-foreground">Select a running server to start chatting.</p></div>'),wt=_('<div class="h-full flex items-center justify-center"><div class="text-center text-muted-foreground"><!> <p>Start a conversation with <strong> </strong></p> <p class="text-sm mt-1"> </p></div></div>'),kt=_('<div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0"><!></div>'),Mt=_("<!> <!>",1),Pt=_('<p class="whitespace-pre-wrap"> </p>'),St=_('<div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center flex-shrink-0"><!></div>'),Nt=_("<div><!> <div><!></div> <!></div>"),Tt=_('<div class="flex gap-3"><div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0"><!></div> <div class="bg-muted rounded-lg px-4 py-2"><!></div></div>'),jt=_("<!> <!>",1),Ct=_('<div class="px-4 py-2 bg-red-100 text-red-700 text-sm"> </div>'),It=_('<div class="flex-1 overflow-y-auto p-4 space-y-4"><!></div> <!> <form class="p-4 border-t"><div class="flex gap-2"><!> <!></div></form>',1),Ot=_('<div class="space-y-6 h-[calc(100vh-8rem)] flex flex-col"><div class="flex items-center justify-between"><h1 class="text-2xl font-bold">Chat</h1> <div class="flex items-center gap-4"><!> <!></div></div> <!></div>');function Ut(N,f){Te(f,!0);const w=()=>dt(vt,"$page",k),[k,M]=lt();let n=V(st([])),i=V(""),d=V(!1),u=V(null),B=V(null);const I=J(()=>ke.profiles.filter(t=>Me.isRunning(t.id))),h=J(()=>e(I).find(t=>t.id===e(B)));ot(()=>{ke.refresh(),Me.refresh();const t=w().url.searchParams.get("profile");t&&x(B,parseInt(t,10),!0)});async function Ce(t){var O,m,T;if(t.preventDefault(),!e(i).trim()||!e(h)||e(d))return;const s=e(i).trim();x(i,""),x(u,null),x(n,[...e(n),{role:"user",content:s}],!0),x(d,!0);try{const v=await fetch(`http://${e(h).host}:${e(h).port}/v1/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e(h).model_path,messages:e(n).map(l=>({role:l.role,content:l.content})),stream:!1})});if(!v.ok){const l=await v.text();throw new Error(`HTTP ${v.status}: ${l}`)}const H=((T=(m=(O=(await v.json()).choices)==null?void 0:O[0])==null?void 0:m.message)==null?void 0:T.content)||"No response";x(n,[...e(n),{role:"assistant",content:H}],!0)}catch(v){x(u,v instanceof Error?v.message:"Failed to send message",!0),x(n,e(n).slice(0,-1),!0)}finally{x(d,!1)}}function Ie(){x(n,[],!0),x(u,null)}function Oe(t){const s=t.target;x(B,s.value?parseInt(s.value,10):null,!0),x(n,[],!0),x(u,null)}function Ee(t){const s=t.split("/");return s.length>1?s[s.length-1]:t}function He(t){const s=t.match(/<think>([\s\S]*?)<\/think>/);if(s){const O=s[1].trim(),m=t.replace(/<think>[\s\S]*?<\/think>/,"").trim();return{thinking:O,response:m}}return{thinking:null,response:t}}var ee=Ot(),te=r(ee),ue=p(r(te),2),pe=r(ue);{let t=J(()=>{var s;return((s=e(B))==null?void 0:s.toString())??""});ct(pe,{onchange:Oe,get value(){return e(t)},children:(s,O)=>{var m=xt(),T=E(m);T.value=T.__value="";var v=p(T,2);Pe(v,17,()=>e(I),C=>C.id,(C,H)=>{var l=$t(),D=r(l);a(l);var Q={};L((re,W)=>{Y(D,`${e(H).name??""} (${re??""})`),Q!==(Q=W)&&(l.value=(l.__value=W)??"")},[()=>Ee(e(H).model_path),()=>e(H).id.toString()]),o(C,l)}),o(s,m)},$$slots:{default:!0}})}var Re=p(pe,2);{var ze=t=>{ne(t,{variant:"outline",onclick:Ie,children:(s,O)=>{oe();var m=xe("Clear Chat");o(s,m)},$$slots:{default:!0}})};j(Re,t=>{e(n).length>0&&t(ze)})}a(ue),a(te);var Be=p(te,2);{var De=t=>{ie(t,{class:"flex-1 flex items-center justify-center",children:(s,O)=>{var m=yt(),T=r(m);q(T,{class:"w-16 h-16 mx-auto text-muted-foreground mb-4"});var v=p(T,4);ne(v,{href:"/servers",children:(C,H)=>{oe();var l=xe("Go to Servers");o(C,l)},$$slots:{default:!0}}),a(m),o(s,m)},$$slots:{default:!0}})},Ae=t=>{var s=K(),O=E(s);{var m=v=>{ie(v,{class:"flex-1 flex items-center justify-center",children:(C,H)=>{var l=bt(),D=r(l);q(D,{class:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),oe(2),a(l),o(C,l)},$$slots:{default:!0}})},T=v=>{ie(v,{class:"flex-1 overflow-hidden flex flex-col",children:(C,H)=>{var l=It(),D=E(l),Q=r(D);{var re=y=>{var P=wt(),R=r(P),A=r(R);q(A,{class:"w-12 h-12 mx-auto mb-4"});var G=p(A,2),S=p(r(G)),g=r(S,!0);a(S),a(G);var c=p(G,2),U=r(c);a(c),a(R),a(P),L(()=>{Y(g,e(h).name),Y(U,`Model: ${e(h).model_path??""}`)}),o(y,P)},W=y=>{var P=jt(),R=E(P);Pe(R,16,()=>e(n),S=>S,(S,g)=>{var c=Nt(),U=r(c);{var X=b=>{var $=kt(),z=r($);q(z,{class:"w-5 h-5 text-primary"}),a($),o(b,$)};j(U,b=>{g.role==="assistant"&&b(X)})}var F=p(U,2),Ue=r(F);{var Fe=b=>{const $=J(()=>He(g.content));var z=Mt(),ge=E(z);{var qe=se=>{ut(se,{get content(){return e($).thinking}})};j(ge,se=>{e($).thinking&&se(qe)})}var Ke=p(ge,2);gt(Ke,{get content(){return e($).response}}),o(b,z)},Je=b=>{var $=Pt(),z=r($,!0);a($),L(()=>Y(z,g.content)),o(b,$)};j(Ue,b=>{g.role==="assistant"?b(Fe):b(Je,!1)})}a(F);var Ve=p(F,2);{var Ye=b=>{var $=St(),z=r($);ht(z,{class:"w-5 h-5 text-primary-foreground"}),a($),o(b,$)};j(Ve,b=>{g.role==="user"&&b(Ye)})}a(c),L(()=>{le(c,1,`flex gap-3 ${g.role==="user"?"justify-end":""}`),le(F,1,`max-w-[80%] rounded-lg px-4 py-2 ${g.role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`)}),o(S,c)});var A=p(R,2);{var G=S=>{var g=Tt(),c=r(g),U=r(c);q(U,{class:"w-5 h-5 text-primary"}),a(c);var X=p(c,2),F=r(X);Ne(F,{class:"w-5 h-5 animate-spin"}),a(X),a(g),o(S,g)};j(A,S=>{e(d)&&S(G)})}o(y,P)};j(Q,y=>{e(n).length===0?y(re):y(W,!1)})}a(D);var _e=p(D,2);{var Ge=y=>{var P=Ct(),R=r(P,!0);a(P),L(()=>Y(R,e(u))),o(y,P)};j(_e,y=>{e(u)&&y(Ge)})}var ae=p(_e,2),he=r(ae),me=r(he);ft(me,{placeholder:"Type a message...",get disabled(){return e(d)},class:"flex-1",get value(){return e(i)},set value(y){x(i,y,!0)}});var Le=p(me,2);{let y=J(()=>e(d)||!e(i).trim());ne(Le,{type:"submit",get disabled(){return e(y)},children:(P,R)=>{var A=K(),G=E(A);{var S=c=>{Ne(c,{class:"w-4 h-4 animate-spin"})},g=c=>{_t(c,{class:"w-4 h-4"})};j(G,c=>{e(d)?c(S):c(g,!1)})}o(P,A)},$$slots:{default:!0}})}a(he),a(ae),nt("submit",ae,Ce),o(C,l)},$$slots:{default:!0}})};j(O,v=>{e(h)?v(T,!1):v(m)},!0)}o(t,s)};j(Be,t=>{e(I).length===0?t(De):t(Ae,!1)})}a(ee),o(N,ee),je(),M()}export{Ut as component};
