import{c as L,a as l,f as y,t as X}from"../chunks/vfPE-AD7.js";import{i as k,p as be,j as De,d as c,s as j,e as s,r,f as o,g as a,u as Pe,t as U,n as E,c as Me,k as pe}from"../chunks/DhUiKsxN.js";import{s as $,e as ke}from"../chunks/Dsv8gxIT.js";import{l as ee,b as te,i as F}from"../chunks/DUil1G3I.js";import{I as ae,a as re,e as he,i as Ne,m as ce,r as $e}from"../chunks/CkjAMN-G.js";import{C as ge,B as Y,I as ze,b as ye}from"../chunks/BXw2ESc5.js";import{g as Be}from"../chunks/DdZy-IqV.js";import{s as V}from"../chunks/D9zMkePZ.js";import{H as Se,f as we,B as ie,T as Ue}from"../chunks/C1cYCadf.js";import"../chunks/1jpszzm8.js";function Ce(N,e){const i=ee(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x=[["path",{d:"M12 17V3"}],["path",{d:"m6 11 6 6 6-6"}],["path",{d:"M19 21H5"}]];ae(N,te({name:"arrow-down-to-line"},()=>i,{get iconNode(){return x},children:(v,w)=>{var m=L(),b=k(m);re(b,e,"default",{}),l(v,m)},$$slots:{default:!0}}))}function je(N,e){const i=ee(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x=[["path",{d:"M20 6 9 17l-5-5"}]];ae(N,te({name:"check"},()=>i,{get iconNode(){return x},children:(v,w)=>{var m=L(),b=k(m);re(b,e,"default",{}),l(v,m)},$$slots:{default:!0}}))}function Fe(N,e){const i=ee(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];ae(N,te({name:"download"},()=>i,{get iconNode(){return x},children:(v,w)=>{var m=L(),b=k(m);re(b,e,"default",{}),l(v,m)},$$slots:{default:!0}}))}function He(N,e){const i=ee(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"}]];ae(N,te({name:"heart"},()=>i,{get iconNode(){return x},children:(v,w)=>{var m=L(),b=k(m);re(b,e,"default",{}),l(v,m)},$$slots:{default:!0}}))}function Ie(N,e){const i=ee(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x=[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]];ae(N,te({name:"search"},()=>i,{get iconNode(){return x},children:(v,w)=>{var m=L(),b=k(m);re(b,e,"default",{}),l(v,m)},$$slots:{default:!0}}))}var Re=y("<!> Downloaded",1),Ee=y('<div class="mt-3 flex flex-wrap gap-1"><!> <!></div>'),Ge=y("<!> Delete",1),Ae=y("<!> <!>",1),Le=y("<!> ",1),Oe=y('<div class="mt-2 text-sm text-red-500"> </div>'),Te=y('<div class="flex items-start justify-between"><div class="flex-1 min-w-0"><h3 class="font-semibold text-base truncate"> </h3> <div class="flex items-center gap-4 mt-1 text-sm text-muted-foreground"><span class="flex items-center gap-1"><!> </span> <span class="flex items-center gap-1"><!> </span> <span class="flex items-center gap-1"><!> </span></div></div> <div class="flex items-center gap-2"><!></div></div> <!> <div class="mt-4 flex justify-end gap-2"><!></div> <!>',1);function Je(N,e){be(e,!0);let i=j(!1),x=j(!1),v=j(null),w=j(null),m=Pe(()=>a(w)??e.model.is_downloaded);De(()=>{e.model.model_id,c(w,null)});async function b(){c(i,!0),c(v,null);try{const{task_id:P}=await ce.startDownload(e.model.model_id),z=new EventSource(`/api/models/download/${P}/progress`);z.onmessage=O=>{const H=JSON.parse(O.data);H.status==="completed"?(c(w,!0),c(i,!1),z.close()):H.status==="failed"&&(c(v,H.error||"Download failed",!0),c(i,!1),z.close())},z.onerror=()=>{c(v,"Connection lost"),c(i,!1),z.close()}}catch(P){c(v,P instanceof Error?P.message:"Download failed",!0),c(i,!1)}}async function Z(){var P;if(confirm(`Delete ${e.model.model_id}?`)){c(x,!0),c(v,null);try{await ce.delete(e.model.model_id),c(w,!1),(P=e.onDeleted)==null||P.call(e)}catch(z){c(v,z instanceof Error?z.message:"Delete failed",!0)}finally{c(x,!1)}}}function se(){var P;(P=e.onUse)==null||P.call(e,e.model.model_id)}ge(N,{class:"p-4",children:(P,z)=>{var O=Te(),H=k(O),G=s(H),A=s(G),ve=s(A,!0);r(A);var oe=o(A,2),T=s(oe),q=s(T);Ce(q,{class:"w-4 h-4"});var me=o(q);r(T);var J=o(T,2),le=s(J);He(le,{class:"w-4 h-4"});var fe=o(le);r(J);var de=o(J,2),ne=s(de);Se(ne,{class:"w-4 h-4"});var ue=o(ne);r(de),r(oe),r(G);var t=o(G,2),f=s(t);{var g=d=>{ie(d,{variant:"success",children:(h,D)=>{var M=Re(),n=k(M);je(n,{class:"w-3 h-3 mr-1"}),E(),l(h,M)},$$slots:{default:!0}})};F(f,d=>{a(m)&&d(g)})}r(t),r(H);var p=o(H,2);{var u=d=>{var h=Ee(),D=s(h);he(D,17,()=>e.model.tags.slice(0,5),Ne,(S,B)=>{ie(S,{variant:"secondary",class:"text-xs",children:(Q,_e)=>{E();var xe=X();U(()=>$(xe,a(B))),l(Q,xe)},$$slots:{default:!0}})});var M=o(D,2);{var n=S=>{ie(S,{variant:"outline",class:"text-xs",children:(B,Q)=>{E();var _e=X();U(()=>$(_e,`+${e.model.tags.length-5}`)),l(B,_e)},$$slots:{default:!0}})};F(M,S=>{e.model.tags.length>5&&S(n)})}r(h),l(d,h)};F(p,d=>{e.model.tags.length>0&&d(u)})}var _=o(p,2),C=s(_);{var K=d=>{var h=Ae(),D=k(h);Y(D,{variant:"outline",size:"sm",onclick:Z,get disabled(){return a(x)},children:(n,S)=>{var B=Ge(),Q=k(B);Ue(Q,{class:"w-4 h-4 mr-1"}),E(),l(n,B)},$$slots:{default:!0}});var M=o(D,2);Y(M,{variant:"default",size:"sm",onclick:se,children:(n,S)=>{E();var B=X("Use");l(n,B)},$$slots:{default:!0}}),l(d,h)},W=d=>{Y(d,{variant:"default",size:"sm",onclick:b,get disabled(){return a(i)},children:(h,D)=>{var M=Le(),n=k(M);Fe(n,{class:"w-4 h-4 mr-1"});var S=o(n);U(()=>$(S,` ${a(i)?"Downloading...":"Download"}`)),l(h,M)},$$slots:{default:!0}})};F(C,d=>{a(m)?d(K):d(W,!1)})}r(_);var I=o(_,2);{var R=d=>{var h=Oe(),D=s(h,!0);r(h),U(()=>$(D,a(v))),l(d,h)};F(I,d=>{a(v)&&d(R)})}U((d,h)=>{$(ve,e.model.model_id),$(me,` ${d??""}`),$(fe,` ${h??""}`),$(ue,` ~${e.model.estimated_size_gb??""} GB`)},[()=>we(e.model.downloads),()=>we(e.model.likes)]),l(P,O)},$$slots:{default:!0}}),Me()}var Qe=y("<!> ",1),Ve=y('<form class="flex gap-4"><div class="flex-1 relative"><!> <!></div> <!></form> <div class="flex items-center gap-4 mt-4"><label class="flex items-center gap-2 text-sm"><input type="checkbox" class="rounded"/> <span> </span></label> <label class="flex items-center gap-2 text-sm"><input type="checkbox" class="rounded"/> <span>Downloaded only</span></label></div>',1),Ze=y('<div class="text-center py-8 text-red-500"> </div>'),qe=y('<section><h2 class="text-lg font-semibold mb-4"> </h2> <div class="grid gap-4"></div></section>'),Ke=y('<div class="text-center py-8 text-muted-foreground">No models found. Try a different search term.</div>'),We=y('<div class="flex items-center justify-between"><div><h3 class="font-medium"> </h3> <p class="text-sm text-muted-foreground"> </p></div> <!></div>'),Xe=y('<section><h2 class="text-lg font-semibold mb-4"> </h2> <div class="grid gap-4"></div></section>'),Ye=y('<div class="text-center py-12 text-muted-foreground">Search for models to download, or browse your local models.</div>'),et=y('<div class="space-y-6"><div class="flex items-center justify-between"><h1 class="text-2xl font-bold">Model Browser</h1> <!></div> <!> <!> <!> <!></div>');function vt(N,e){be(e,!0);let i=j(""),x=j(pe([])),v=j(pe([])),w=j(!1),m=j(null),b=j(!0),Z=j(!1);De(()=>{se(),V.refreshMemory()});async function se(){try{c(v,await ce.listLocal(),!0)}catch(t){console.error("Failed to load local models:",t)}}async function P(){if(a(i).trim()){c(w,!0),c(m,null);try{const t=a(b)&&V.memory?V.memory.mlx_recommended_gb:void 0;c(x,await ce.search(a(i),t,20),!0)}catch(t){c(m,t instanceof Error?t.message:"Search failed",!0)}finally{c(w,!1)}}}function z(t){Be(`/profiles/new?model=${encodeURIComponent(t)}`)}function O(){se()}const H=Pe(()=>a(Z)?a(x).filter(t=>t.is_downloaded):a(x));var G=et(),A=s(G),ve=o(s(A),2);{var oe=t=>{ie(t,{variant:"outline",class:"text-sm",children:(f,g)=>{var p=Qe(),u=k(p);Se(u,{class:"w-4 h-4 mr-1"});var _=o(u);U(C=>$(_,` Recommended: <${C??""} GB`),[()=>V.memory.mlx_recommended_gb.toFixed(0)]),l(f,p)},$$slots:{default:!0}})};F(ve,t=>{V.memory&&t(oe)})}r(A);var T=o(A,2);ge(T,{class:"p-4",children:(t,f)=>{var g=Ve(),p=k(g),u=s(p),_=s(u);Ie(_,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"});var C=o(_,2);ze(C,{placeholder:"Search mlx-community models...",class:"pl-10",get value(){return a(i)},set value(n){c(i,n,!0)}}),r(u);var K=o(u,2);Y(K,{type:"submit",get disabled(){return a(w)},children:(n,S)=>{E();var B=X();U(()=>$(B,a(w)?"Searching...":"Search")),l(n,B)},$$slots:{default:!0}}),r(p);var W=o(p,2),I=s(W),R=s(I);$e(R);var d=o(R,2),h=s(d);r(d),r(I);var D=o(I,2),M=s(D);$e(M),E(2),r(D),r(W),U(n=>$(h,`Fits in memory (<${n??""} GB)`),[()=>{var n;return((n=V.memory)==null?void 0:n.mlx_recommended_gb.toFixed(0))??80}]),ke("submit",p,n=>{n.preventDefault(),P()}),ye(R,()=>a(b),n=>c(b,n)),ye(M,()=>a(Z),n=>c(Z,n)),l(t,g)},$$slots:{default:!0}});var q=o(T,2);{var me=t=>{var f=Ze(),g=s(f,!0);r(f),U(()=>$(g,a(m))),l(t,f)};F(q,t=>{a(m)&&t(me)})}var J=o(q,2);{var le=t=>{var f=qe(),g=s(f),p=s(g);r(g);var u=o(g,2);he(u,21,()=>a(H),_=>_.model_id,(_,C)=>{Je(_,{get model(){return a(C)},onUse:z,onDeleted:O})}),r(u),r(f),U(()=>$(p,`Search Results (${a(H).length??""})`)),l(t,f)},fe=t=>{var f=L(),g=k(f);{var p=u=>{var _=Ke();l(u,_)};F(g,u=>{a(i)&&!a(w)&&u(p)},!0)}l(t,f)};F(J,t=>{a(x).length>0?t(le):t(fe,!1)})}var de=o(J,2);{var ne=t=>{var f=Xe(),g=s(f),p=s(g);r(g);var u=o(g,2);he(u,21,()=>a(v),_=>_.model_id,(_,C)=>{ge(_,{class:"p-4",children:(K,W)=>{var I=We(),R=s(I),d=s(R),h=s(d,!0);r(d);var D=o(d,2),M=s(D);r(D),r(R);var n=o(R,2);Y(n,{size:"sm",onclick:()=>z(a(C).model_id),children:(S,B)=>{E();var Q=X("Use");l(S,Q)},$$slots:{default:!0}}),r(I),U(S=>{$(h,a(C).model_id),$(M,`${S??""} GB`)},[()=>a(C).size_gb.toFixed(2)]),l(K,I)},$$slots:{default:!0}})}),r(u),r(f),U(()=>$(p,`Downloaded Models (${a(v).length??""})`)),l(t,f)},ue=t=>{var f=L(),g=k(f);{var p=u=>{var _=Ye();l(u,_)};F(g,u=>{a(i)||u(p)},!0)}l(t,f)};F(de,t=>{a(v).length>0&&!a(i)?t(ne):t(ue,!1)})}r(G),l(N,G),Me()}export{vt as component};
